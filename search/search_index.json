{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Home","text":""},{"location":"#tre-documentation","title":"TRE Documentation","text":"<p>If you are new to the Genes &amp; Health TRE, we recommend reading the following TRE doc sections:</p> <ol> <li>Getting started as a new user</li> <li>Using the TRE</li> <li>Getting data in and out of the TRE</li> </ol> <p>We welcome user-driven updates to the docs.  If you would like to contribute, please read the How to update this documentation section and contact us to be added to our github documentation repository.</p>"},{"location":"explainers/","title":"Explainers","text":""},{"location":"explainers/#how-is-data-linked","title":"How is data linked","text":"<p>When volunteers take part in stage 1 of Genes &amp; Health their questionnaire and consent form is labelled with the ID number on the Oragene saliva tube (style: 15001502031604). These Oragene IDs are then used to label genetic samples (e.g. GSA chip or exome seq). They also label the Questionnaire. Some people have taken part twice (or more than twice) over the years in Genes &amp; Health, and will have a different Oragene ID each time.</p> <p>Genes &amp; Health uses the Questionnaire data to look up a volunteer\u2019s <code>5236\\_cram\\_IDlinkage.xlsx</code> (if not already provided). The NHS number (style: 1234567890 ) is one-way pseudonymised (always in the same way using the same encryption key) and the pseudoNHS number (style: 0EDFCE604D373660DDF34CA5CBDB754E3BAA17835530591C0161E459A82C7821) is the identified for all types of health record data. A volunteer should only have one single NHS number in NHS systems (we have found a few exceptions to this rule that we have reported to NHS Digital for consideration of merging).</p> <p>A file is provided linking Oragene ID to pseudoNHS number (see below). Note that this linkage sometimes changes slightly e.g. if we find a missing NHS number, for new samples, or if we identify an error in previous NHS number lookup.</p> <p>Recall studies (stage 2) get their own stage 2 ID. We will provide files linking to pseudoNHS number. The primary identifier used for volunteer recall is the NHS number.</p> <p>Wellcome Sanger Institute has used several other ID types e.g. sanger sample ID, cram file ID, EBI-EGA submission ID. See below. Broad Institute uses the Oragene ID with a prefix (style: GNH-15001502031604).</p>"},{"location":"explainers/#where-are-the-data-from","title":"Where are the data from","text":""},{"location":"explainers/#raw-health-data-overview-under-construction","title":"Raw health data overview (UNDER CONSTRUCTION)","text":""},{"location":"explainers/#summary","title":"Summary","text":"<p>This page provides an overview of the raw health data available to Genes and Health TRE users. All files described below are located in genesandhealth/library-red, please see the page describing TRE file structures for further information. File paths described below assume you are starting from genesandhealth/library-red</p> <p>For complete descriptions of file contents, please see the raw health data description.</p> <p>All folders contain detailed README.txt files, which describe the contents of each data file in more detail (number of rows, number of G\\&amp;H volunteers present in the file etc).</p>"},{"location":"explainers/#primary-care-data","title":"Primary care data","text":"<p>Primary care datasets and linkage are provided by agreement with GP practices, made at the CCG level. As of 2023-04-14 all primary care data are for participants registered with practices in East London only. Data are refreshed periodically to add complete historical records for new participants, and to update existing participants' records with information from clinical contacts made since the previous refresh.</p>"},{"location":"explainers/#london","title":"London","text":"<p>All files are located in /DSA_Discovery_7CCGs. Subfolders are created for each data refresh. Folder names are the date of the refresh. For refreshes before 2023_01 data are further split by Clinical Commissioning Group (CCG).</p> <ol> <li> <p>GNH_thwfnech are for volunteers registered at practices in Tower Hamlets, Waltham Forest, Newham, City &amp; Hackney CCGs  </p> </li> <li> <p>GNH_bhr are for volunteers registered at practices in Barking, Havering, Redbridge and outer east London CCGs</p> </li> </ol> <p>For refreshes after 2023-01 the data for these two regions are combined.</p> <p>As of 2023-01 Genes and Health does not have access to data for volunteers registered with practices in the North West London and South East London CCGS</p> <p>Data files Each folder contains the following files, all containing raw, individual level data, with one row per observation.</p> <ul> <li> <p>medications_ord for normal repeat prescriptions  </p> </li> <li> <p>medications_stmt for short term medications and treatments  </p> </li> <li> <p>observations for diagnoses, blood test results, clinical measurements, other tests and referrals  </p> </li> <li> <p>procedure_req for health and medication reviews, screening and vaccination records</p> </li> </ul> <p>All files contain:</p> <ul> <li> <p>A pseudo nhs number for linkage across all health data, and to the Genes and Health OrageneID number.  </p> </li> <li> <p>SNOMED concept ID for describing diagnoses, procedures, and prescriptions (useful for generating binary traits)  </p> </li> <li> <p>value results (for test results e.g. creatinine, height etc where applicable and useful for generating quantitative traits)  </p> </li> <li> <p>value units (where applicable) describing the unit of measurement (e.g. meters or cm for height)  </p> </li> <li> <p>Clinical effective date (usually when the SNOMED code was entered into the patient record)</p> </li> </ul>"},{"location":"explainers/#bradford","title":"Bradford","text":"<p>No raw primary care data as of 2023-04-14</p>"},{"location":"explainers/#manchester","title":"Manchester","text":"<p>No raw primary care data as of 2023-04-14</p>"},{"location":"explainers/#secondary-care-data","title":"Secondary care data","text":"<p>Hospital Episode Statistics (HES) data will be available on the TRE soon (pending NHS Digital approval at 2023-04-14), and for most purposes will supersede the regionally sourced secondary care data described below (HES will replicate the majority of data, and because it offers nationwide coverage, will include more G\\&amp;H volunteers).</p> <p>At present, secondary care data are split by location. As of 2023-04-14 secondary care data are available for volunteers in London and Bradford.</p>"},{"location":"explainers/#london_1","title":"London","text":"<p>All files are located in DSA_BartsHealth_NHS_Trust. Subfolders are created for each data refresh. Folder names are the date of the refresh. Data are retrieved from the Barts Health Trust Data Warehouse and contain information on visits made by Genes and Health volunteers to hospitals in that Trust only.</p> <p>Barts Trust provides multiple datasets that are unique/ specific to that Trust, including pathology lab data (useful for generating quantitative traits), prescribing data, and radiology department reports. Some datasets are only available by special request (e.g. maternity bookings, chemotherapy prescribing). Please see the README.txt in the DSA_BartsHealth_NHS_Trust folder for further details.</p> <p>Data in the icd_10_combined_redacted.txt and opcs_combined_redacted.txt files will have substantial overlap with HES (see note above on availability), and are useful for generating binary traits</p>"},{"location":"explainers/#bradford_1","title":"Bradford","text":"<p>Data provided by Bradford Teaching Hospitals NHS foundation trust</p>"},{"location":"explainers/#manchester_1","title":"Manchester","text":"<p>No raw primary care data as of 2023-04-14</p>"},{"location":"explainers/#what-do-the-raw-data-look-like","title":"What do the raw data look like","text":"<p>This section describes the raw phenotype files currently available in the TRE, and their location in the TRE file structure. Column headings are replicated directly, brief summaries of file contents and column contents will be updated.</p> <p>For most users and use cases, this documment should serve as a reference guide only. Members of the GH data team have used the raw files described here to produce curated products, that will in most cases be more useful (and user friendly).</p> <p>/genesandhealth/library-red/genesandhealth/phenotypes_rawdata/DSA__BartsHealth_NHS_Trust/2021_04_PathologyLab/AntiMullerianHormone_April2021.csv</p> PseudoNHSNo Age At Test Test Name Date of Test Result Unit Type description here Type description here Type description here Type description here Type description here Type description here"},{"location":"explainers/#phenotype-curation-under-construction","title":"Phenotype Curation (UNDER CONSTRUCTION)","text":"<p>This page provides a few examples of how the raw health data in the TRE have been curated to produce useful output for a range of analyses. The files used in the examples below are all located in genesandhealth/library-red, please see the page describing TRE file structures for further information. An overview of the different datafiles are available in the raw phenotype data page</p>"},{"location":"explainers/#tools","title":"Tools","text":"<p>The philosophy of the Genes and Health project is to provide researchers with the tools to generate their own phenotypes as well as providing a curated set of phenotypes.</p> <p>The curated phenotypes are generated using the tre-tools package, which is a custom package developed by the Data Team. A curated phenotype is a phenotype that has been generated using a set of codelists that have been checked and validated by researchers in Genes and Health.</p> <p>The code is available at tre-tools. We strongly recommend that you use this package to generate your own phenotypes, as the code has been generated by the Data Team using a software engineering approach, and has been thoroughly tested.</p>"},{"location":"explainers/#codelists","title":"Codelists","text":"<p>There are a number of codelists available in the TRE that can be used to generate phenotypes. These are stored in the library-red folder. The codelists are stored in a folder called codelists and are named according to the phenotype they are used to generate.</p> <p>Codelists are simple csv files that contain the codes that are used to generate the phenotype. If you wish to use your own codelist, simply utilise the provided clipboard functionality, allowing you to transfer text data, such as CSV files, from your local machine to the TRE.</p> <p>In order to make sure that analyses are only carried out with codelists that have the expected structure (i.e. the correct format for ICD10), the Data Team have created a set of tools in tre-tools that can be used to check the codelists.</p> <p>The tool checks that all codes in the codelist conform to the expected format, and that there are no duplicate codes. For example, checking that a SNOMED codelist only contains SNOMED codes which have the format of a numerical value between 6 and 18 digits in length.</p>"},{"location":"explainers/#example-code","title":"Example code","text":"<p>The following code loads a codelist called Diabetes.</p> <p>diabetes.csv</p> code,term\u000b\"100000001\",\"Type 2 Diabetes\"\u000b\"100000002\",\"Diabetic Review\" from tretools.codelists.codelist_types import CodelistType\u000bfrom tretools.codelists.codelist import Codelist\u000b\u000b# Load the codelist\u000bdiabetes \\= Codelist(\"diabetes.csv\", CodelistType.SNOMED.value) <p>In the example above, we have loaded a codelist called diabetes.csv which contains two SNOMED codes. The Codelist class is used to load the codelist, and the CodelistType enum is used to specify the type of codelist. In this case, the codelist is a SNOMED codelist. If any of the codes in the codelist do not conform to the expected format, an error will be raised.</p> <p>For more information on how to use the tre-tools package, please see the tre-tools documentation, and the test files in the tre-tools repository for examples of how to use the package. We welcome any feedback on the package, and are happy to help with any issues you may encounter.</p>"},{"location":"explainers/#binary-traits","title":"Binary Traits","text":"<p>Binary traits are those that have two possible outcomes, such as disease status (e.g. diabetes, hypertension). A person either has the disease or they do not.</p> <p>The raw health data in the TRE is curated to produce binary traits for a range of analyses. The files used in the examples below are all located in genesandhealth/library-red. There is a lengthy readme file in the folder that describes the data in detail, along with timestamps for when the data was last updated. We recommend that you read this file before using the data.</p> <p>The binary traits data was generated using the tre-tools custom package. The code is available at tre-tools. The data has been cleaned and processed for use in a range of analyses. The data includes all the primary care and hospital data for the Genes and Health cohort, and has been processed and saved in a format that is easy to use for different types of analyses. The cleaning processes are described in the README file in the folder but in summary:</p> <ul> <li>Each data file has been loaded and de-duplicated on the basis of the unique identifier for each patient, date and code.  </li> <li>All datasets of the same coding system (for example, ICD10) have been merged into a single dataset for each \"time cut\" of data received.  </li> <li>All datasets have been merged into a single dataset for each coding system.</li> </ul> <p>Binary trait reports are generated using the tre-tools package and use ProcessedDataset and Codelist classes to generate a PhenotypeReport object. The PhenotypeReport object can then be used to generate a range of reports for the binary traits, including Regenie input files.</p>"},{"location":"explainers/#example-workflow","title":"Example workflow","text":""},{"location":"explainers/#example-code_1","title":"Example code","text":""},{"location":"explainers/#quantitative-traits","title":"Quantitative traits","text":""},{"location":"explainers/#codelists_1","title":"Codelists","text":""},{"location":"explainers/#example-workflow_1","title":"Example workflow","text":""},{"location":"explainers/#example-code_2","title":"Example code","text":""},{"location":"genes-and-health-tre-documentation/","title":"Genes &amp; Health TRE Documentation v3.0","text":"<p>TO CLOSE THIS AND MOVE TO STUARTs NEW WEBSITE</p> <p>NOR MORE CHANGES FROM 24 JULY 2025</p> <p>Table of Contents (clickable!)</p> <p>Latest TRE data updates and changes</p> <p>What is TRE ?</p> <p>Trusted Research Environment (TRE)</p> <p>Sandboxes and what each sandbox can access</p> <p>Getting started as a new user</p> <p>Pre-requisites</p> <p>Getting access steps</p> <p>Setting up a profile</p> <p>Starting the TRE</p> <p>Choosing your required machine configuration</p> <p>Choosing a custom machine configuration</p> <p>Switching off the machine</p> <p>GWAS Training Video</p> <p>GWAS Example</p> <p>Folder and bucket structure</p> <p>library-red</p> <p>Red</p> <p>Understanding G\\&amp;H Buckets</p> <p>G\\&amp;H and Google Cloud Storage (GCS) Buckets</p> <p>GCS Buckets and Directories</p> <p>G\\&amp;H GCS Bucket URLs</p> <p>Copying data to red</p> <p>Folder structures</p> <p>consortiumpriorityperiod-library-red</p> <p>Green folders</p> <p>green</p> <p>consortiumpriorityperiod-library-green</p> <p>Other folders</p> <p>shared</p> <p>pipelines</p> <p>Public datasets bucket</p> <p>Copying between Google Buckets within the TRE</p> <p>Backups</p> <p>Shared folders</p> <p>Sandbox-specific folders</p> <p>What genetic and health data is where</p> <p>TRE folders and what is in them</p> <p>Software, modules, requesting installs</p> <p>Software Available</p> <p>Linux command line software</p> <p>Programming languages</p> <p>Python</p> <p>R</p> <p>Instructions for specific software</p> <p>Integrated Genome Viewer (IGV)</p> <p>LibreOffice</p> <p>Git</p> <p>File browser shortcuts</p> <p>How to get new software installed</p> <p>Software request</p> <p>Developer requests</p> <p>How to use docker</p> <p>How to write hash symbols</p> <p>How to get your data in</p> <p>Copying text in</p> <p>Getting user data into the TRE</p> <p>How to increase disk size\u200b</p> <p>Requesting data out of the TRE</p> <p>Getting your results out</p> <p>What is allowed out?</p> <p>Existing data</p> <p>Requesting data</p> <p>Accessing TRE data from external systems/internet</p> <p>Explainers</p> <p>How is data linked</p> <p>Where are the data from</p> <p>Raw health data overview (UNDER CONSTRUCTION)</p> <p>Summary</p> <p>Primary care data</p> <p>London</p> <p>Bradford</p> <p>Manchester</p> <p>Secondary care data</p> <p>London</p> <p>Bradford</p> <p>Manchester</p> <p>What do the raw data look like</p> <p>Phenotype Curation (UNDER CONSTRUCTION)</p> <p>Tools</p> <p>Codelists</p> <p>Example code</p> <p>Binary Traits</p> <p>Example workflow</p> <p>Example code</p> <p>Quantitative traits</p> <p>Codelists</p> <p>Example workflow</p> <p>Example code</p> <p>How to get Help</p>"},{"location":"genes-and-health-tre-documentation/#latest-tre-data-updates-and-changes","title":"Latest TRE data updates and changes","text":"<p>(newest shown first)</p> <p>2025-MAY-20 by DVH Begun release of 55k exome ExWAS to Consortium1 partners. Quant traits initially, to be followed by binary traits. gs://qmul-production-library-consortiumpriorityperiod-red/Callsets/2024_05_55kCallset/release_2025-JUN-16_ExWAS/</p> <p>2025-MAY-05 by DVH Released 51k GSA-TOPMEDr3 GWAS results for v010 quant traits gs://qmul-production-library-red/genesandhealth/GSAv3EAMD/Jan2024_51k_TOPMED-r3_Imputation_b38/2025_05_v010_quantpy_GSATOPMEDr3_GWAS/</p> <p>2025-APR-28 by RK Improved the file dialog that allows users to upload files to the red bucket. Users can now upload files to the red bucket in the directory of their choice and create a new directory in the red bucket if they wish.</p> <p>2025-APR-24 by DVH More Barts Health datafiles from 2024_09 release redaacted and put in the TRE gs://qmul-production-library-red/genesandhealth/phenotypes_rawdata/DSA__BartsHealth_NHS_Trust/2024_09_ResearchDataset/</p> <p>2025-APR-24 by DVH New quant traits v010 uploaded,  gs://qmul-production-library-red/genesandhealth/phenotypes_curated/version010_2025_04/</p> <p>2025-MAR-26 by DVH Uploaded new NHS England (ex Digital) HES data. More datasets still to come. gs://qmul-production-library-vnhsdigital-sublicence-red/DSA__NHSDigitalNHSEngland/2025_03/</p> <p>2025-MAR-26 by DVH Uploaded new folder of gvcf files from exome sequencing. These are the input to variant joint calling. They are unfiltered samples and genotypes, do not use for genetic association studies! gs://qmul-production-library-consortiumpriorityperiod-red/gvcfs/</p> <p>2025-MAR-25 by DVH Removal of some files in previous Barts Health phenotypes_raw datasets, and replacement with more highly redacted versions.</p> <p>Deleted gs://qmul-production-library-red/genesandhealth/phenotypes_rawdata/DSA__BartsHealth_NHS_Trust/2024_09_ResearchDataset/RDE_Measurements.ascii.redacted.tab Replaced with: gs://qmul-production-library-red/genesandhealth/phenotypes_rawdata/DSA__BartsHealth_NHS_Trust/2024_09_ResearchDataset/RDE_Measurements.ascii.redacted2.tab</p> <p>Deleted: gs://qmul-production-library-red/genesandhealth/phenotypes_rawdata/DSA__BartsHealth_NHS_Trust/2023_12_ResearchDatasetv1.6/GandH_Measurements__20240423.ascii.redacted.tab Replaced with: gs://qmul-production-library-red/genesandhealth/phenotypes_rawdata/DSA__BartsHealth_NHS_Trust/2023_12_ResearchDatasetv1.6/GandH_Measurements__20240423.ascii.redacted2.tab</p> <p>Deleted - we do not think this file is used at all, so have not replaced. gs://qmul-production-library-red/genesandhealth/phenotypes_rawdata/DSA__BartsHealth_NHS_Trust/2023_12_ResearchDatasetv1.6/in-beta-testing/GH_RAW_Pathology__20231211.ascii.redacted.tab</p> <p>Deleted: gs://qmul-production-library-red/genesandhealth/phenotypes_rawdata/DSA__BartsHealth_NHS_Trust/2024_09_ResearchDataset/RDE_Pathology.ascii.nohisto.redacted.csv Replaced with: gs://qmul-production-library-red/genesandhealth/phenotypes_rawdata/DSA__BartsHealth_NHS_Trust/2024_09_ResearchDataset/RDE_Pathology.ascii.nohisto.redacted2.csv</p> <p>Deleted: gs://qmul-production-library-red/genesandhealth/phenotypes_rawdata/DSA__BartsHealth_NHS_Trust/2023_12_ResearchDatasetv1.6/GH_Pathology__20231218.ascii.nohisto.redacted.tab Replaced with: gs://qmul-production-library-red/genesandhealth/phenotypes_rawdata/DSA__BartsHealth_NHS_Trust/2023_12_ResearchDatasetv1.6/GH_Pathology__20231218.ascii.nohisto.redacted2.tab</p>"},{"location":"genes-and-health-tre-documentation/#what-is-a-tre-?","title":"What is a TRE ?","text":"<p>Many large genetics and health data studies such as Finngen, UK Biobank, Genomics England are using Trusted Research Environments (TREs). Also known as Secure Data Environments. NHS England and Health Data Research UK are strongly supporting this model. </p> <p>The essential qualities of a TRE are</p> <ul> <li>The TRE restricts access to data inside the TRE to authenticated users, who are given access in a highly controlled manner  </li> <li>The TRE doesn\u2019t allow users to export data without inspection from the project\u2019s Data Controller or a delegate.  </li> <li>The TRE doesn\u2019t allow users to import code or data without inspection from the project\u2019s Data Controller or a delegate.</li> </ul> <p>That is, researchers must enter the secure environment of a TRE to work on the data inside, and cannot export summary results without inspection, to ensure no sensitive personal data is being exported.</p> <p>In our case, many NHS Providers will not supply clinical data (including sensitive personal data) for GnH participants unless GnH can house it in an ISO27001-certified TRE.</p>"},{"location":"genes-and-health-tre-documentation/#sandboxes-and-what-each-sandbox-can-access","title":"Sandboxes and what each sandbox can access","text":"<p>You will likely only have access to one sandbox for your project/institution/company and this is likely to be shared with some other users. However, some users will have access to multiple sandboxes. These can be viewed and switched between in the top right menu.</p> <p>Only selected sandboxes have access to the WDL high-performance compute pipelines. Currently, we will enable pipelines for sandboxes only if you provide your own Google Cloud Billing Account. In this case, you are responsible for any excess or inadvertent spend.</p> Sandbox number Sandbox name Industry Consortium1 buckets access NHS England data bucket access WDL Pipelines access GCP Billing Account code and name 1 QMUL + WSI Core Team yes yes yes begins 01E01\u2026 \u201cSanger Main Billing Account\u201d 2 External Academics no no no begins 01936\u2026 \u201cQMUL - Genes &amp; Health - CTS\u201d 3 GSK yes no no begins 01E01\u2026 \u201cSanger Main Billing Account\u201d 4 BMS yes no no begins 01E01\u2026 \u201cSanger Main Billing Account\u201d 5 MSD yes no no begins 01E01\u2026 \u201cSanger Main Billing Account\u201d 6 Takeda yes no no begins 01E01\u2026 \u201cSanger Main Billing Account\u201d 7 Pfizer yes no no begins 01E01\u2026 \u201cSanger Main Billing Account\u201d 8 S00050_FFAIR-PRS (NIH grant, PI Pradeep Natarjan) no no no begins 00EE8\u2026 \u201cBroad Institute - 5001256 (Primed-4)\u201d 9 Maze Therapeutics yes no no begins 01E01\u2026 \u201cSanger Main Billing Account\u201d 10 Novo Nordisk yes no no begins 01E01\u2026 \u201cSanger Main Billing Account\u201d 11 University of Exeter no yes no begins 01241\u2026 \u201cG+H Billing Account\u201d ~~12~~ ~~Genomics PLC~~ ~~no~~ ~~no~~ ~~no~~ ~~project has finished, deleted~~ 13 AstraZeneca yes no yes begins 01650\u2026 \u201cBilling for astrazeneca.net\u201d 14 External Academic, Consortium Access yes no no begins 01936\u2026 \u201cQMUL - Genes &amp; Health - CTS\u201d 15 5 Prime Sciences no no no begins 01483\u2026 \u201cBrent\u2019s Billing Account\u201d 16 S00073 Levine Glastonbury no No no 0167D \u201cUCL_Adam_Levine\u201d 17 Academic, NHS Digital access no yes no begins 01936\u2026 \u201cQMUL - Genes &amp; Health - CTS\u201d"},{"location":"genes-and-health-tre-documentation/#getting-started-as-a-new-user","title":"Getting started as a new user","text":""},{"location":"genes-and-health-tre-documentation/#steps-to-get-access","title":"Steps to get access","text":"<ol> <li> <p>All users must read and accept the Genes &amp; Health Code of Conduct.</p> </li> <li> <p>All users must complete the NHS Data Security Awareness Level 1 training before they're granted access to Genes and Health data.</p> </li> </ol> <p>Users with an academic email address (.ac.uk) or an NHS email address (@nhs.net) can register for the Data Security Awareness training at e-learning for Healthcare.</p> <p>Caution If you're a Wellcome Sanger Institute employee, please use ODS Code 8J947 and select Genome Research Limited from the list of organisations when you register for the course.</p> <p>Non-academic users can register for the training course at eIntegrity Healthcare e-learning.</p> <p>After completing the NHS Data Security Awareness Level 1 training course, all users must attest to the Genes &amp; Health Code of Conduct and upload their certificate to Genes &amp; Health new user registration system. Please contact Genes and Health at genesandhealth@qmul.ac.uk for instructions on how to access the new user registration system.</p> <p>These steps are important for our  NHS Digital Data Security and Protection Toolkit, and ISO 27001 accreditation.</p> <p>Caution Users who have not completed the Data Security Awareness training or attested to the Code of Conduct are subject to having their account deactivated.</p>"},{"location":"genes-and-health-tre-documentation/#setting-up-a-profile","title":"Setting up a profile","text":"<p>When first set up, users will get an email from Google (to their normal email address). This will have a username@genesandhealth.qmul.ac.uk username. You need to Add this as a Profile in Google Chrome. Please do not try to use any other browser than Google Chrome!</p> <p>Note: This username is not an email address, and we will not send email to it. It cannot receive email; it is just a username for the TRE.</p> <p>Once you have done this, go to Manage Your Account and Security and turn 2 Step Verification on. You will need to enter a phone number and get a code by SMS/text message. You cannot access the TRE without this enabled.</p>"},{"location":"genes-and-health-tre-documentation/#starting-the-tre","title":"Starting the TRE","text":"<p>Having selected your username@genesandhealth.qmul.ac.uk account as your Chrome Profile, enter the G\\&amp;H TRE\u2019s URL in your Chrome browser. Your URL will start with https://new-production.genesandhealth.qmul.ac.uk/. The full URL is dependent on your sandbox and can be obtained from the table below.</p> <p>This will take you to the TRE login page. You will be asked to enter your username and password. The username is the one you have been given by the Genes and Health team, and the password is the one you have set up when you first logged in.</p> <p>If you want to go a specific sandbox, you can use the following URL table:</p> Sandbox URL Sandbox 1 - QMUL +WSI Core Team Desktop https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-1/vm Sandbox 2 - External Academic Desktop https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-2/vm Sandbox 3 - GSK Desktop https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-3/vm Sandbox 4 - BMS Desktop https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-4/vm Sandbox 5 - MSD Desktop https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-5/vm Sandbox 6 - Takeda Desktop https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-6/vm Sandbox 7 - Pfizer Desktop https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-7/vm Sandbox 8 - S00050_FFAIR-PRS Desktop https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-8/vm Sandbox 9 - Maze Therapeutics Desktop https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-9/vm Sandbox 10 - Novo Nordisk Desktop https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-10/vm Sandbox  11 - University of Exter https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-11/vm Sandbox 13 - AstraZeneca https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-13/vm Sandbox 14 - External Academic, Consortium access https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-14/vm Sandbox 15 - 5 Prime Sciences https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-15/vm Sandbox 16 - Sandbox 16 https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-16/vm Sandbox 17 - Academic, NHS Digital access https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-17/vm"},{"location":"genes-and-health-tre-documentation/#choosing-your-required-machine-configuration","title":"Choosing your required machine configuration","text":"<p>Once logged in, you will be taken to the Virtual Machines page where you can start a new machine or connect to an existing one.</p> <p></p> <p>You will be offered a variety of virtual machine types.</p> <p>Warning: Choose the Basic machine unless a script requires high memory or increased CPU capacity, and is ready to go. Test your script on the Basic machine first, as other options are more expensive.</p> <p>Note: Some machine types have many CPUs, which are suitable for multithreaded applications like plink or regenie that can fully utilise them. These applications may sometimes run input/output operations too quickly for standard Google bucket storage, requiring you to copy key files to faster local storage (see below).</p>"},{"location":"genes-and-health-tre-documentation/#choosing-a-custom-machine-configuration","title":"Choosing a custom machine configuration","text":"<p>It is possible that sometimes you may require a Virtual Machine that offers resources different to the standard flavors i.e. higher-memory, higher-cpu or memory-optimised instances. You can choose a custom VM configuration from the Virtual Machines page by expanding the Use custom Virtual Machine profile section at the bottom.</p> <p></p> <p>Warning: Choose the Use custom Virtual Machine profile only when absolutely necessary, use Basic machine unless a script requires high memory or increased CPU capacity. Excess use of higher-spec machines can significantly impact running costs. Test your script on the Basic machine first, as other options are more expensive.</p>"},{"location":"genes-and-health-tre-documentation/#switching-off-the-machine","title":"Switching off the machine","text":"<p>Your virtual machine will keep running for 24 hours if you are doing nothing. You can disconnect from Chrome, turn your laptop off, and then you will be straight back into the exact same machine when you connect again (within 24h). If you have Linux jobs running, the machine will keep going while these run (however long) plus another 48h.</p> <p>Warning: Keeping machines running in the background costs money. So please actively shutdown (if you do not need the extra 48h) using the little off button on the bottom of the side menu.</p>"},{"location":"genes-and-health-tre-documentation/#gwas-training-video","title":"GWAS Training Video","text":"<p>Genes &amp; Health have provided a number of training videos to help researchers get started with the Trusted Research Environment (TRE). This is a 45-min tutorial in which GWAS using regenie is demonstrated (300Mb with mp4 format, updated 5 oct 2022). This video is a recording of a live demo session, and the quality may not be perfect. It is recommended to watch the video in full screen mode. Please feel free to download the video and watch it at your convenience. https://dl.dropboxusercontent.com/s/k6h5botp53xk3l6/TRE%20Training-20220928_160450-Meeting%20Recording.mp4?e=1\\&amp;dl=0</p>"},{"location":"genes-and-health-tre-documentation/#gwas-example","title":"GWAS Example","text":"<p>You can find an example regenie script for binary trait GWAS below. Please feel free to adapt and reuse this script.</p> <ul> <li>Please let your script run first on the cheap 2-core machine. Regenie has excellent multithreading capabilities and will perform best on the 64-core high-performance machine, but this option is expensive. The 2-core machine is sufficiently fast on a large multicore machine, allowing you to run it directly from the command line using a single all-chromosome pgen input file, without the need for HPC or splitting by chromosome. Regenie will utilise all available threads minus 1 by default, meaning the 64-core machine will run 63 times faster for the compute steps compared to the 2-core machine. It is fast enough on a large multicore machine to run several phenotypes. If you intend to run 1000 phenotypes, you will need to use Google HPC / WDL.</li> </ul> ## RUN THIS FROM THE FOLDER WITH THE COVAR/PHENO FILES AND WHERE YOU WANT THE OUTPUT\u000b\u000b## this is for BINARY TRAITS\u000b## remove the  --bt and firth etc options for quant traits, see the online regenie manual https://rgcgithub.github.io/regenie/options/\u000b\u000b## first copy big files to local storage ivm SSD for better i/o than with google storage buckets\u000b## regenie will sometimes crash if reading direct from library-red due to slow i/o\u000b## cp /genesandhealth/library-red/genesandhealth/GSAv3EAMD/Jul2021_44k_TOPMED-r2_Imputation_b38/topmed-r2_merged_version03/chrALLincX.dose.merged_INFO0.3_MAF0.00001_F_MISSING0.2.8bit.sorted.p* /home/ivm/Documents/\u000b\u000b## CHANGE THE DATE EACH RUN ## \u000bdaterun=2022_07_20\u000b     \u000bcovarfile=\"/genesandhealth/library-red/genesandhealth/GSAv3EAMD/Jul2021_44k_TOPMED-r2_Imputation_b38/GNH.44190.noEthnicOutliers.covariates.20PCs.tab\"\u000b## updated to covarfile with correct FID IID structure 15 July 2022\u000b\u000bphenofile=\"/genesandhealth/library-red/genesandhealth/phenotypes_curated/version005_2022_06/1stoccurrence_3digitICD10_1SNOMEDto1ICD10/2022_06_version005_3digitICD10_1to1_42029withbothICD10andGSAJul2021.txt\"\u000b\u000b## these are the custom phenotypes: \"/genesandhealth/library-red//genesandhealth/phenotypes_curated/version005_2022_06/custom/2022-06-15_big_regenie_phenoFile.txt\"\u000b\u000bgrmfile=\"/genesandhealth/library-red/genesandhealth/GSAv3EAMD/Jul2021_44k_TOPMED-r2_Imputation_b38/bfile_forSAIGEgrm_44396_chipgenotypes_indep-pairwise_500_50_0.2_LDpruned_NotChrY\"\u000b\u000b## regenie will run all phenotypes in the phenoFIle if you dont specify --phenoCol or --phenoColList\u000b\u000b## beware the .log file does not have phenotype name in its filename (because it is designed for running many phenotypes at once), can get overwritten if run multiple times using same $daterun\u000b\u000b## if want to run male-only or female-only analysis, best to use --keep with a list of individuals in Step1 Step2 rather than --sex-specific. Because sex-specific uses the sex in the bed or pgen files not from the covariate file. And sex is NA in the pgen file we have made\u000b\u000bregenie   \\\u000b  --step 1 \\\u000b  --bed \"$grmfile\" \\\u000b  --covarFile \"$covarfile\" \\\u000b  --phenoFile \"$phenofile\" \\\u000b  --phenoExcludeList PseudoNHS_2022_02_08 \\\u000b  --phenoCol ICD10__E10,ICD10__E11 \\\u000b  --minCaseCount 100 \\\u000b  --bsize 1000 \\\u000b  --bt \\\u000b  --lowmem \\\u000b  --lowmem-prefix tmp_rg \\\u000b  --gz \\\u000b  --verbose \\\u000b  --out \"$daterun\"_fit_binary_out\u000b\u000bregenie \\\u000b  --step 2 \\\u000b  --pgen /home/ivm/Documents/chrALLincX.dose.merged_INFO0.3_MAF0.00001_F_MISSING0.2.8bit.sorted \\\u000b  --covarFile \"$covarfile\" \\\u000b  --phenoFile \"$phenofile\" \\\u000b  --bsize 1000 \\\u000b  --minMAC 20 \\\u000b  --minINFO 0.6 \\\u000b  --bt \\\u000b  --firth --approx \\\u000b  --pThresh 0.01 \\\u000b  --pred \"$daterun\"_fit_binary_out_pred.list \\\u000b  --gz \\\u000b  --verbose \\\u000b  --out \"$daterun\"_GNH_binary_GWAS_firth\u000b\u000b## END ##"},{"location":"genes-and-health-tre-documentation/#folder-and-bucket-structure","title":"Folder and bucket structure","text":"<p>Folders are suffixed with red or green to indicate the type of data that is stored there. Red is for potentially sensitive data that should not be shared outside. Green is for data that can be shared with the outside world. When you log into your sandboxes, you will have a number of folders available for you. To get started, we will concentrate on the library-red, red, and home folders.</p> <p>This reference page goes through the other folders and explains what they are for and how they should be used. The following is a high-level overview of the directories in the TRE: </p>"},{"location":"genes-and-health-tre-documentation/#library-red","title":"library-red","text":"<p>Available at library-red in your sandbox, this is a read-only folder that is shared between all users. It contains the data you need for your analyses. library-red is slower storage of large capacity (&gt;8 PiB as of February). For large files, the entire file must be read and cached first by gcsfuse; direct file seeking to a specific part of the file is not possible.For high-performance or large files, it may be better to make a copy to red or home/ivm. library-red corresponds to the Google Storage bucket gs://qmul-sandbox-production-library-red/ (read-write access only for admins). library-red stores curated and raw data necessary for your analysis. This is where you will find the data you need to run your analysis. It includes several subfolders, each designated for specific data types and purposes. If you find a folder without a readme file, please contact the Genes and Health team for more information on its intended use.</p>"},{"location":"genes-and-health-tre-documentation/#red","title":"Red","text":"<p>In this section we explain what G\\&amp;H buckets are and the 3 methods for managing data on the G\\&amp;H TRE\u2019s red bucket. The three ways to manipulate folders and files in the red bucket are:</p> <ol> <li>using the \u201cUpload to red bucket\u201d option in the File Manager,  </li> <li>using the gcloud command line interface,  </li> <li>mounting your red folder into your virtual machine.</li> </ol>"},{"location":"genes-and-health-tre-documentation/#understanding-g&h-buckets","title":"Understanding G\\&amp;H Buckets","text":""},{"location":"genes-and-health-tre-documentation/#g&h-and-google-cloud-storage-(gcs)-buckets","title":"G\\&amp;H and Google Cloud Storage (GCS) Buckets","text":"<p>Genes &amp; Health TRE data are stored in Google Cloud Storage (GCS) buckets (on a server located in London, UK). Buckets are the basic data container for GCS and everything stored in GCS must be contained in a bucket. Each of the usual G\\&amp;H TRE top level storage domains are separate GCS buckets, for example, library-red, red, green and exomes-library-red. The red bucket is for TRE users to store scripts and data safely (with versioning back-up) and to permit the sharing of these between project collaborators. Files in a G\\&amp;H TRE bucket are just that. The bucket contains a collection of files.</p>"},{"location":"genes-and-health-tre-documentation/#gcs-buckets-and-directories","title":"GCS Buckets and Directories","text":"<p>The concept of a physical directory does not rightly exist in GCS. Rather, directories are \u201csimulated\u201d by GCS from the files name. This can be illustrated as follows:  In the image above, the filenames are \u201cA/Obj1.txt\u201d, \u201cA/Obj2.txt\u201d, \u201cB/Obj3.txt\u201d, \u201cB/D/Obj3.txt\u201d and \u201cB/D/Obj4.txt\u201d and the files simply exists a files in the bucket with those filenames. Bucket folders \u2018A/\u2019 and \u2018B/\u2019 and the sub-folder \u2018D/\u2019 are simulated. This means that is you were to delete \u201cA/Obj1.txt\u201d and \u201cA/Obj2.txt\u201d, the simulated folder \u201cA/\u201d would disappear (there would no longer be filenames justifying its existence). However, if you were to delete file \u201cB/Obj3.txt\u201d, both simulated folder \u2018B/\u2019 and sub-folder \u2018D/\u2019 would remains as they would be accounted for by filenames \u201cB/D/Obj3.txt\u201d and \u201cB/D/Obj4.txt\u201d. In the rest of this guide, when we refer to (GCS) directories, we refer to such simulated directories.</p>"},{"location":"genes-and-health-tre-documentation/#g&h-gcs-bucket-urls","title":"G\\&amp;H GCS Bucket URLs","text":"<p>On the TRE, /red/ \u201clives\u201d on the file system (/genesandhealth/red/) as shown below: </p> <p>Physically though, as the /red/ bucket is stored on a Google Cloud file server, it has a Uniform Resource Locator (URL). The URL will depend on the sandbox you use. For sandbox-1, the URL is gs://qmul-production-sandbox-1-red/ and, predictably, you need to change the number in the URL to match your sandbox number. When moving things to and from the red bucket using either gcloud (Option 2) or file mounting (Option 3), you will need to use the URL.</p>"},{"location":"genes-and-health-tre-documentation/#copying-data-to-red","title":"Copying data to red","text":"<p>Once you have located the file/folder you want to copy into red, right click on that object and select \u201cUpload to red bucket\u201d:</p> <p></p> <p>A new window will then pop-up allowing you to select where in red you want this data to go (\u201cred\u201d is the top directory in red so it\u2019s recommended you navigate to a personal or project red directory before selecting \u201cOK\u201d): </p> <ul> <li> <p>You can use the \u201cBrowse\u201d button to find and select existing directories in red.</p> </li> <li> <p>If you select the \u201cCreate New Folder\u201d button, it will prompt you for a name, and then create a new folder in the location currently selected.</p> </li> <li> <p>Selecting \u201cOK\u201d will begin the copying process into the directory chosen and you will see a new window documenting the outcome, for example:   </p> </li> </ul> <p></p>"},{"location":"genes-and-health-tre-documentation/#folder-structures","title":"Folder structures","text":""},{"location":"genes-and-health-tre-documentation/#consortiumpriorityperiod-library-red","title":"consortiumpriorityperiod-library-red","text":"<p>This bucket is only available to the core Genes &amp; Health team, and to companies in the Genes &amp; Health Industry Consortium. It contains data restricted during 9 month priority access periods (e.g. exome sequencing). Specifically, read access is only for sandboxes 1 3 4 5 6 7 9 10 13.</p> <p>Same storage type as /genesandhealth/library-red, see comments above</p> <p>/genesandhealth/consortiumpriorityperiod-library-red is a google storage bucket gs://qmul-sandbox-production-library-consortiumpriorityperiod-red (read+write only for admins)</p>"},{"location":"genes-and-health-tre-documentation/#green-folders","title":"Green folders","text":""},{"location":"genes-and-health-tre-documentation/#green","title":"green","text":"<p>Specific to each sandbox.</p> <p>green can be read by other users in the sandbox. Users cannot write to green.</p> <p>Users can download from /genesandhealth/green from internet/external systems.</p> <p>The admin team will review data out requests, and either place the data in green (for specific users to download, short term) or library-green (long term availability for all users to download).</p> <p>Data in each sandbox green will be deleted approx 1 week after creation. green is not intended for long term storage, only data transfer/download.</p> <p>Same storage type as /genesandhealth/library-red, see comments above.</p> <p>/genesandhealth/green is a google bucket gs://fg-qmul-production-sandbox-1_green/ (read only for users, read+write only for admins) (replace the 1 with whichever sandbox you want)</p>"},{"location":"genes-and-health-tre-documentation/#consortiumpriorityperiod-library-green","title":"consortiumpriorityperiod-library-green","text":"<p>Access as for consortiumpriorityperiod-library-red but with external download (e.g. gsutil) enabled. Used for results. Not for individual level data.</p> <p>gs://qmul-sandbox-production-library-consortiumpriorityperiod-green</p>"},{"location":"genes-and-health-tre-documentation/#other-folders","title":"Other folders","text":""},{"location":"genes-and-health-tre-documentation/#shared","title":"shared","text":"<p>You can 'publish' a file to /genesandhealth/shared by right clicking on it, and selected 'Share with all users'</p> <p>/genesandhealth/shared is available to all other users within the TRE.</p>"},{"location":"genes-and-health-tre-documentation/#pipelines","title":"pipelines","text":"<p>This is the output of the high performance compute WDL Pipelines, that the ivm/pipeline writes to. Users of the sandbox have read only access.</p> <p>Specific to each sandbox.</p> <p>This is slower storage of large capacity (&gt;8 PiB @ Feb 2022)</p>"},{"location":"genes-and-health-tre-documentation/#public-datasets-bucket","title":"Public datasets bucket","text":"<p>We also maintain a bucket for public datasets. This is not visible from within the TRE. Much of the data is mirrored in genesandhealth/library-green/ within the TRE.</p> <p>gs://genesandhealth_publicdatasets/</p>"},{"location":"genes-and-health-tre-documentation/#copying-between-google-buckets-within-the-tre","title":"Copying between Google Buckets within the TRE","text":"<p>Is permitted from within the TRE, subject to user read/write permissions as above.</p> <p>Admins may copy from Google Buckets to external systems. However external copy from external Google Buckets direct to/from TRE Google Buckets is prohibited for security reasons.</p>"},{"location":"genes-and-health-tre-documentation/#backups","title":"Backups","text":"<p>Data in selected folders is protected from accidental deletion or alteration by the Google Object Versioning service. Specifically, for data in these folders -</p>"},{"location":"genes-and-health-tre-documentation/#shared-folders","title":"Shared folders","text":"<p>/genesandhealth/library-red , 1 version, 30 days</p> <p>/genesandhealth/consortiumpriorityperiod-library-red, 1 version, 30 days</p> <p>/genesandhealth/nhsdigital-sublicence-red, 1 version, 30 days</p>"},{"location":"genes-and-health-tre-documentation/#sandbox-specific-folders","title":"Sandbox-specific folders","text":"<p>/genesandhealth/red, 2 versions, 30 days</p> <p>/genesandhealth/pipeline, 1 version, 7 days</p> <p>We will keep either a) the prior version of the data prior to a change (or deletion) by a user for 30 days , or b) two prior versions of the data prior to a change (or deletion) by a user for 30 days.</p> <p>This allows the prior version to be restored, in the event of accidental erasure or deletion.</p> <p>To say this another way: imagine you accidentally alter or delete a file in the /genesandhealth/library-red folder. Then the version of the file prior to its removal can be restored, for up to 30 days after the change. In the sandbox-specific /genesandhealth/red folder, two prior versions of the file will be kept, each for 30 days after the change leading to its creation.</p> <p>Restoring a prior version of an accidentally removed or modified file requires utilities only available to administrators: if you need this, contact us using Slack or writing to hgi@sanger.ac.uk, including the word \"Urgent\" in the subject header.</p>"},{"location":"genes-and-health-tre-documentation/#what-genetic-and-health-data-is-where","title":"What genetic and health data is where","text":""},{"location":"genes-and-health-tre-documentation/#tre-folders-and-what-is-in-them","title":"TRE folders and what is in them","text":"<p>PseudoNHS number serves as a unique identifier for individuals and is used for health data and phenotype identification. Oragene ID consists of a 14-digit code, like 15123456789012, and serves as an identifier for saliva tube DNA IDs. Multiple samples may be collected from the same individual, resulting in a many-to-one relationship between Oragene ID and NHS number. Genetic assays, such as exome sequencing or GSA chip analysis, are assigned assay IDs. For GSA chip analysis, the assay ID consists of the Oragene ID concatenated with the Illumina chip ID and row position. Exome sequencing assay IDs follow the format GNH-15123456789012_2, with the suffix accommodating multiple assays of a single Oragene ID. Multiple or repeated assays may be conducted on the same Oragene ID.</p> <p>There is a file linking Oragene ID (for genetics &amp; questionnaire data) with PseudoNHS number (for NHS e-health record data). This file may get updated and re-dated:</p> /library-red/genesandhealth/2022_05_12_pseudoNHS_oragene_withmissing_DEIDENTIFIED.txt <p>Illumina GSAv3EAMD genotyping chip and TOPMed-r2 imputation data:</p> /library-red/genesandhealth/GSAv3EAMD/ <p>Exome sequencing data. As of February 2022 n=5236 low/mid depth samples sequenced at Wellcome Sanger Institute and funded by Wellcome Sanger Institute are available. Both aligned cram files and callset vcfs are available. The file 5236_cram_IDlinkage.xlsx links Oragene IDs with multiple ID types used by Wellcome Sanger Institute. Industry Consortium funded exome sequencing data on the full 50,000+ Genes &amp; Health volunteer cohort during 9 month post datafreeze priority period will only be available in /consortiumpriorityperiod-library-red/ After the priority period data will go into:</p> /library-red/genesandhealth/exome_seq/ <p>Phenotypes which have been manually or automatically curated for consistency:</p> /library-red/genesandhealth/phenotypes_curated/ <p>See also this document which has data descriptions, case counts, and phenotype codelists.</p> <p>'Raw' phenotype and health record data (NHS numbers pseudonymised, and de identified of names, postcodes, dates of birth etc).</p> /library-red/genesandhealth/phenotypes_rawdata/ <p>Data is organised by provider and data sharing agreement. This is so we can easily change access if any of the terms of data sharing change.</p> <p>Please note as of Feb 2023, we do not yet have permission from NHS Digital to put their data in the TRE. An amendment is awaited.</p> <p>A reference for the NHS Digital Data Model and dictionary can be found on NHS Digital reference.</p> <p>The genesandhealth folder contains downloadable data 'publicly' available to users (read-only):</p> /library-green/genesandhealth/ <p>Please see the README files in each folder for detail, e.g.,as of February 2022 there is regenie GWAS data on \\~180 phenotypes.</p>"},{"location":"genes-and-health-tre-documentation/#software,-modules,-requesting-installs","title":"Software, modules, requesting installs","text":""},{"location":"genes-and-health-tre-documentation/#software-available","title":"Software Available","text":""},{"location":"genes-and-health-tre-documentation/#linux-command-line-software","title":"Linux command line software","text":"<p>A very comprehensive set of genomics and genetics software is available for running from the Linux Terminal command line. See also Appendix for example scripts.</p> <p>Some software has very good multithreading e.g. plink2 or regenie. If you run these on the 64 core ivm (please test on the cheap 2-core machine first) you can get performance quite close to high performance compute (HPC) for some medium sized applications, and you do not have to learn WDL scripts. Alternatively, true cloud HPC is available using WDL Pipelines (see below).</p>"},{"location":"genes-and-health-tre-documentation/#programming-languages","title":"Programming languages","text":"<p>There are a number of different languages available on the TRE including Python and R. We also have Bash as a shell program and command language.</p>"},{"location":"genes-and-health-tre-documentation/#python","title":"Python","text":"<p>It is worth noting that Python does not have the normal virtual environment setup that you might be used to. It is not possible to install packages using pip install as you would on your local machine as the TRE does not have internet access, and therefore cannot connect to the Python Package Index (PyPI), or a specific GitHub repository. Packages are installed by the Sanger Institute and are available to all users.</p> <p>Jupyter notebooks Jupyter is available in the Applications menu as graphical user interface and can also be run from the Linux command line, by running jupyter notebook in the terminal.</p> <p>VS Code The VS Code editor is available in the Applications menu as graphical user interface and via the command line by using code .. It has limited plugins available as they must be specifically requested and installed by the Sanger Institute. The Jupyter notebook plugin is already installed.</p> <p>Any commands or scripts that rely on outside software will not work in the VS Code terminal unless the software is installed in the Linux command line. For example, Github Co-pilot will not work in the VS Code terminal.</p>"},{"location":"genes-and-health-tre-documentation/#r","title":"R","text":"<p>RStudio is available in the Applications menu as a graphical user interface for programmers interested in R language. It can be launched from the command line via rstudio.</p>"},{"location":"genes-and-health-tre-documentation/#instructions-for-specific-software","title":"Instructions for specific software","text":""},{"location":"genes-and-health-tre-documentation/#integrated-genome-viewer-(igv)","title":"Integrated Genome Viewer (IGV)","text":"<p>We have installed IGV to run from the Linux Terminal command line (not the web browser version). Make sure you are using the right genome fasta for your cram files, otherwise you will get an 'md5 error' (e.g. the default hg19 will not work with Wellcome Sanger Institute crams).</p> <p>Example for the 5236 Wellcome Sanger Institute low depth exomes:</p> /usr/local/bin/IGV_Linux_2.12.3/igv.sh --genome /genesandhealth/library-red/genesandhealth/exome_seq/2019_11__5236_GNHonly/crams/hs38DH.fa\u000b/genesandhealth/library-red/genesandhealth/exome_seq/2019_11__5236_GNHonly/crams/sc_autozygELGH6823965.cramb <p>The default set of (hg19) files for IGV are found here</p> /genesandhealth/library-green/sanger/igv/"},{"location":"genes-and-health-tre-documentation/#libreoffice","title":"LibreOffice","text":"<p>LibreOffice provides equivalents for Microsoft Excel, Powerpoint, Word etc and is available in Applications menu as graphical user interface (not from Linux command line).</p>"},{"location":"genes-and-health-tre-documentation/#git","title":"Git","text":"<p>Git is available from the Linux command line for single user use and has some limited integration with RStudio and Jupyter Notebooks. However, given the fact that the TRE does not have internet access and everyone is signed in as the same user, Git's use is limited. This may change in the future.</p>"},{"location":"genes-and-health-tre-documentation/#file-browser-shortcuts","title":"File browser shortcuts","text":"<p>The file browser for Xfce is called 'Thunar'. Settings and defaults should persist between sessions but do not always.</p> <p>Detailed view [ctrl + 2] New tab [ctrl + t] (only works if the TRE is in fullscreen mode - Chrome will create a new tab otherwise)</p>"},{"location":"genes-and-health-tre-documentation/#how-to-get-new-software-installed","title":"How to get new software installed","text":""},{"location":"genes-and-health-tre-documentation/#software-request","title":"Software request","text":"<p>Only admins can install new software. As there is no internet access, this also includes CRAN, github, PyPI etc. To get a new software installed, please raise a help desk request. This is done by emailing hgi@sanger.ac.uk to generate a ticket. This will take a few days to a week to complete.</p> <p>Note: Please note that if you wish to use a package that relies on an external service, such as a database or reference data, you will need to make sure that this data is also available on the TRE. This is because the TRE does not have internet access and cannot connect to external services.</p>"},{"location":"genes-and-health-tre-documentation/#developer-requests","title":"Developer requests","text":"<p>If you are a developer and want to install custom software, for example, a python package that you have written, you can request this to be installed by the Sanger Institute. It will be available to all users. This may require some additional information to be provided to the Sanger Institute particularly around security and data protection.</p>"},{"location":"genes-and-health-tre-documentation/#how-to-use-docker","title":"How to use docker","text":"<p>Using singularity from the command line. Now enabled. First raise a ticket with hgi@sanger.ac.uk and ask for the docker image you want to be installed in the TRE. You then call the .sif image for your analysis. If your pipeline has other dependencies (i.e. needs R libraries, or reference datasets etc.) you need to do the set-up outside the TRE, zip and import through the airlock (you can't do the import step yourself). Once in the TRE and after the docker image is installed, you can run the docker from the command line with singularity shell /pathway/dockerimage.sif.</p> <p>Tip: Do not forget you need to mount the directories you need for reading/writing within the singularity (i.e. -B).</p>"},{"location":"genes-and-health-tre-documentation/#how-to-write-hash-symbols","title":"How to write hash symbols","text":"<p>Apologies, this is tricky! Either copy paste it in using the Clipboard, or from an existing document/script already in the TRE.</p> <p>Or if you must you can type as follows:</p> <ul> <li> <p>Press Ctrl+Shift+u (it has to be Ctrl, not Command)</p> </li> <li> <p>You should see a \"u\" appear, underlined, at your cursor</p> </li> <li> <p>Type \"23\", then press Enter</p> </li> </ul>"},{"location":"genes-and-health-tre-documentation/#how-to-get-your-data-in","title":"How to get your data in","text":"<p>Sometimes it is necessary to get data or code into the TRE. As the TRE is shut off from the internet this presents a challenge. This guide explains how to do this.</p>"},{"location":"genes-and-health-tre-documentation/#copying-text-in","title":"Copying text in","text":"<p>A small amount of text can be pasted in from external systems using the Clipboard tool. This does not allow copy/paste out. This might be useful should you need to copy in a difficult to write function for example.</p>"},{"location":"genes-and-health-tre-documentation/#getting-user-data-into-the-tre","title":"Getting user data into the TRE","text":"<p>You can upload data to your Sandbox specific green-uploads bucket, which you can find using the table below:</p> Sandbox Link to green-uploads bucket Sandbox 1 - QMUL +WSI Core Team Desktop https://console.cloud.google.com/storage/browser/qmul-production-sandbox-1_greenuploads Sandbox 2 - External Academic Desktop https://console.cloud.google.com/storage/browser/qmul-production-sandbox-2_greenuploads Sandbox 3 - GSK Desktop https://console.cloud.google.com/storage/browser/qmul-production-sandbox-3_greenuploads Sandbox 4 - BMS Desktop https://console.cloud.google.com/storage/browser/qmul-production-sandbox-4_greenuploads Sandbox 5 - MSD Desktop https://console.cloud.google.com/storage/browser/qmul-production-sandbox-5_greenuploads Sandbox 6 - Takeda Desktop https://console.cloud.google.com/storage/browser/qmul-production-sandbox-6_greenuploads Sandbox 7 - Pfizer Desktop https://console.cloud.google.com/storage/browser/qmul-production-sandbox-7_greenuploads Sandbox 8 - S00050_FFAIR-PRS Desktop https://console.cloud.google.com/storage/browser/qmul-production-sandbox-8_greenuploads Sandbox 9 - Maze Therapeutics Desktop https://console.cloud.google.com/storage/browser/qmul-production-sandbox-9_greenuploads Sandbox 10 - Novo Nordisk Desktop https://console.cloud.google.com/storage/browser/qmul-production-sandbox-10_greenuploads Sandbox  11 - University of Exter https://console.cloud.google.com/storage/browser/qmul-production-sandbox-11_greenuploads Sandbox 13 - AstraZeneca https://console.cloud.google.com/storage/browser/qmul-production-sandbox-13_greenuploads Sandbox 14 - External Academic, Consortium access https://console.cloud.google.com/storage/browser/qmul-production-sandbox-14_greenuploads Sandbox 15 - 5 Prime Sciences https://console.cloud.google.com/storage/browser/qmul-production-sandbox-15_greenuploads Sandbox 16 - Sandbox 16 https://console.cloud.google.com/storage/browser/qmul-production-sandbox-16_greenuploads Sandbox 17 - Academic, NHS Digital access https://console.cloud.google.com/storage/browser/qmul-production-sandbox-17_greenuploads <p>Once uploaded, please email hgi@sanger.ac.uk with the names of the files/directories you'd like to be transferred and which Sandbox you like them to be transferred to.</p> <p>Tip: Please be aware at present, all users in your sandbox can see all data that is being stored in the green library. For this reason, it is important that you do not upload any data that you do not want other users to see, fo example, individual level data.</p>"},{"location":"genes-and-health-tre-documentation/#how-to-increase-disk-size\u200b","title":"How to increase disk size\u200b","text":"<p>By default, your /home directory's disk size is 100G. If you need to increase the disk size of your /home directory for any reason, you can do so from the Virtual Machines page.</p> <ol> <li>Shutdown your VM if it is running.  </li> <li>While creating a new VM from the Virtual Machines page, click on the Resize home disk section to expand it.  </li> <li>Use the slider to adjust the disk size according to your needs.  </li> <li>Start the new VM with your preffered machine type.</li> </ol> <p>The /home disk will be extended to the new size and previous data will be retained.</p>"},{"location":"genes-and-health-tre-documentation/#_1","title":"Genes &amp; Health TRE Documentation v3.0","text":"<p>Note: Please note that it is recommended to store long-term data in the red bucket and we advise to not treat the /home directory as your permanent storage location. Disk size can be increased upto 1000G.</p>"},{"location":"genes-and-health-tre-documentation/#requesting-data-out-of-the-tre","title":"Requesting data out of the TRE","text":""},{"location":"genes-and-health-tre-documentation/#getting-your-results-out","title":"Getting your results out","text":"<p>You might be wondering how do I get my results of my analytical code out into the world so they can be used in publications or other studies.</p>"},{"location":"genes-and-health-tre-documentation/#what-is-allowed-out?","title":"What is allowed out?","text":"<p>Individual level data is not allowed out of the TRE. Any data out requests are reviewed by the Genes &amp; Health core team to make sure they do not contain individual level data. Summary statistics, graphs etc are all usually fine. For more information, please read the below policy document:</p> <p>Download file: Policy - open disclosure of phenotypes and variants with counts and small numbers - v2.5</p>"},{"location":"genes-and-health-tre-documentation/#existing-data","title":"Existing data","text":"<p>There are a number of files in library-green that are available for download. These do not need a request to be made.</p>"},{"location":"genes-and-health-tre-documentation/#requesting-data","title":"Requesting data","text":"<p>You can make a request to download your results by right-clicking the file and selecting \"request file download\" for any file in:</p> /genesandhealth/red <p>or</p> /genesandhealth/pipeline <p>This sends an automated email to the Genes &amp; Health team. If you have not received a response within 48h please feel free to chase us up (e.g. by Slack). The team will copy the data to either /green (for users of your sandbox only, to be able to download) or to /library-green (for all users to be able to download)(see above). Please note that you can make one data out request per week.</p>"},{"location":"genes-and-health-tre-documentation/#accessing-tre-data-from-external-systems/internet","title":"Accessing TRE data from external systems/internet","text":"<p>Users can download data from greendownloads or library-green using linux command line gcloud storage.</p> <p>Alternatively, you can use the web-interface for your Sandbox specific green-downloads bucket, you can find the link for your sandbox using the table below:</p> Sandbox Link to green-downloads bucket Sandbox 1 - QMUL +WSI Core Team Desktop https://console.cloud.google.com/storage/browser/qmul-production-sandbox-1_greendownloads Sandbox 2 - External Academic Desktop https://console.cloud.google.com/storage/browser/qmul-production-sandbox-2_greendownloads Sandbox 3 - GSK Desktop https://console.cloud.google.com/storage/browser/qmul-production-sandbox-3_greendownloads Sandbox 4 - BMS Desktop https://console.cloud.google.com/storage/browser/qmul-production-sandbox-4_greendownloads Sandbox 5 - MSD Desktop https://console.cloud.google.com/storage/browser/qmul-production-sandbox-5_greendownloads Sandbox 6 - Takeda Desktop https://console.cloud.google.com/storage/browser/qmul-production-sandbox-6_greendownloads Sandbox 7 - Pfizer Desktop https://console.cloud.google.com/storage/browser/qmul-production-sandbox-7_greendownloads Sandbox 8 - S00050_FFAIR-PRS Desktop https://console.cloud.google.com/storage/browser/qmul-production-sandbox-8_greendownloads Sandbox 9 - Maze Therapeutics Desktop https://console.cloud.google.com/storage/browser/qmul-production-sandbox-9_greendownloads Sandbox 10 - Novo Nordisk Desktop https://console.cloud.google.com/storage/browser/qmul-production-sandbox-10_greendownloads Sandbox  11 - University of Exter https://console.cloud.google.com/storage/browser/qmul-production-sandbox-11_greendownloads Sandbox 13 - AstraZeneca https://console.cloud.google.com/storage/browser/qmul-production-sandbox-13_greendownloads Sandbox 14 - External Academic, Consortium access https://console.cloud.google.com/storage/browser/qmul-production-sandbox-14_greendownloads Sandbox 15 - 5 Prime Sciences https://console.cloud.google.com/storage/browser/qmul-production-sandbox-15_greendownloads Sandbox 16 - Sandbox 16 https://console.cloud.google.com/storage/browser/qmul-production-sandbox-16_greendownloads Sandbox 17 - Academic, NHS Digital access https://console.cloud.google.com/storage/browser/qmul-production-sandbox-17_greendownloads <p>From your external system, ideally Linux server rather than laptop if you are downloading lots of data (e.g. our GWAS).</p> <p>Login to gcloud with:</p> _gcloud auth login_ <p>Login with your username@genesandhealth.qmul.ac.uk that you use for TRE access from your browser. It is likely to ask you for 2 Factor Authentication either via phone or via a website link.</p> <p>From a multicore Linux server, and especially if you are trying to transfer lots of data/files</p> gcloud storage buckets list gs://qmul-sandbox-production-library-green/_ <p>To transfer file use:</p> gcloud storage cp \\&lt;local-file-path&gt; gs://\\&lt;bucket-name&gt;/\\&lt;destination-path&gt;"},{"location":"genes-and-health-tre-documentation/#explainers","title":"Explainers","text":""},{"location":"genes-and-health-tre-documentation/#how-is-data-linked","title":"How is data linked","text":"<p>When volunteers take part in stage 1 of Genes &amp; Health their questionnaire and consent form is labelled with the ID number on the Oragene saliva tube (style: 15001502031604). These Oragene IDs are then used to label genetic samples (e.g. GSA chip or exome seq). They also label the Questionnaire. Some people have taken part twice (or more than twice) over the years in Genes &amp; Health, and will have a different Oragene ID each time.</p> <p>Genes &amp; Health uses the Questionnaire data to look up a volunteer's 5236_cram_IDlinkage.xlsx(if not already provided). The NHS number (style: 1234567890 ) is one-way pseudonymised (always in the same way using the same encryption key) and the pseudoNHS number (style: 0EDFCE604D373660DDF34CA5CBDB754E3BAA17835530591C0161E459A82C7821) is the identified for all types of health record data. A volunteer should only have one single NHS number in NHS systems (we have found a few exceptions to this rule that we have reported to NHS Digital for consideration of merging).</p> <p>A file is provided linking Oragene ID to pseudoNHS number (see below). Note that this linkage sometimes changes slightly e.g. if we find a missing NHS number, for new samples, or if we identify an error in previous NHS number lookup.</p> <p>Recall studies (stage 2) get their own stage 2 ID. We will provide files linking to pseudoNHS number. The primary identifier used for volunteer recall is the NHS number.</p> <p>Wellcome Sanger Institute has used several other ID types e.g. sanger sample ID, cram file ID, EBI-EGA submission ID. See below. Broad Institute uses the Oragene ID with a prefix (style: GNH-15001502031604).</p>"},{"location":"genes-and-health-tre-documentation/#where-are-the-data-from","title":"Where are the data from","text":""},{"location":"genes-and-health-tre-documentation/#raw-health-data-overview-(under-construction)","title":"Raw health data overview (UNDER CONSTRUCTION)","text":""},{"location":"genes-and-health-tre-documentation/#summary","title":"Summary","text":"<p>This page provides an overview of the raw health data available to Genes and Health TRE users. All files described below are located in genesandhealth/library-red, please see the page describing TRE file structures for further information. File paths described below assume you are starting from genesandhealth/library-red</p> <p>For complete descriptions of file contents, please see the raw health data description.</p> <p>All folders contain detailed README.txt files, which describe the contents of each data file in more detail (number of rows, number of G\\&amp;H volunteers present in the file etc).</p>"},{"location":"genes-and-health-tre-documentation/#primary-care-data","title":"Primary care data","text":"<p>Primary care datasets and linkage are provided by agreement with GP practices, made at the CCG level. As of 2023-04-14 all primary care data are for participants registered with practices in East London only. Data are refreshed periodically to add complete historical records for new participants, and to update existing participants' records with information from clinical contacts made since the previous refresh.</p>"},{"location":"genes-and-health-tre-documentation/#london","title":"London","text":"<p>All files are located in /DSA_Discovery_7CCGs. Subfolders are created for each data refresh. Folder names are the date of the refresh. For refreshes before 2023_01 data are further split by Clinical Commissioning Group (CCG).</p> <ol> <li> <p>GNH_thwfnech are for volunteers registered at practices in Tower Hamlets, Waltham Forest, Newham, City &amp; Hackney CCGs  </p> </li> <li> <p>GNH_bhr are for volunteers registered at practices in Barking, Havering, Redbridge and outer east London CCGs</p> </li> </ol> <p>For refreshes after 2023-01 the data for these two regions are combined.</p> <p>As of 2023-01 Genes and Health does not have access to data for volunteers registered with practices in the North West London and South East London CCGS</p> <p>Data files Each folder contains the following files, all containing raw, individual level data, with one row per observation.</p> <ul> <li> <p>medications_ord for normal repeat prescriptions  </p> </li> <li> <p>medications_stmt for short term medications and treatments  </p> </li> <li> <p>observations for diagnoses, blood test results, clinical measurements, other tests and referrals  </p> </li> <li> <p>procedure_req for health and medication reviews, screening and vaccination records</p> </li> </ul> <p>All files contain:</p> <ul> <li> <p>A pseudo nhs number for linkage across all health data, and to the Genes and Health OrageneID number.  </p> </li> <li> <p>SNOMED concept ID for describing diagnoses, procedures, and prescriptions (useful for generating binary traits)  </p> </li> <li> <p>value results (for test results e.g. creatinine, height etc where applicable and useful for generating quantitative traits)  </p> </li> <li> <p>value units (where applicable) describing the unit of measurement (e.g. meters or cm for height)  </p> </li> <li> <p>Clinical effective date (usually when the SNOMED code was entered into the patient record)</p> </li> </ul>"},{"location":"genes-and-health-tre-documentation/#bradford","title":"Bradford","text":"<p>No raw primary care data as of 2023-04-14</p>"},{"location":"genes-and-health-tre-documentation/#manchester","title":"Manchester","text":"<p>No raw primary care data as of 2023-04-14</p>"},{"location":"genes-and-health-tre-documentation/#secondary-care-data","title":"Secondary care data","text":"<p>Hospital Episode Statistics (HES) data will be available on the TRE soon (pending NHS Digital approval at 2023-04-14), and for most purposes will supersede the regionally sourced secondary care data described below (HES will replicate the majority of data, and because it offers nationwide coverage, will include more G\\&amp;H volunteers).</p> <p>At present, secondary care data are split by location. As of 2023-04-14 secondary care data are available for volunteers in London and Bradford.</p>"},{"location":"genes-and-health-tre-documentation/#london-1","title":"London","text":"<p>All files are located in DSA_BartsHealth_NHS_Trust. Subfolders are created for each data refresh. Folder names are the date of the refresh. Data are retrieved from the Barts Health Trust Data Warehouse and contain information on visits made by Genes and Health volunteers to hospitals in that Trust only.</p> <p>Barts Trust provides multiple datasets that are unique/ specific to that Trust, including pathology lab data (useful for generating quantitative traits), prescribing data, and radiology department reports. Some datasets are only available by special request (e.g. maternity bookings, chemotherapy prescribing). Please see the README.txt in the DSA_BartsHealth_NHS_Trust folder for further details.</p> <p>Data in the icd_10_combined_redacted.txt and opcs_combined_redacted.txt files will have substantial overlap with HES (see note above on availability), and are useful for generating binary traits</p>"},{"location":"genes-and-health-tre-documentation/#bradford-1","title":"Bradford","text":"<p>Data provided by Bradford Teaching Hospitals NHS foundation trust</p>"},{"location":"genes-and-health-tre-documentation/#manchester-1","title":"Manchester","text":"<p>No raw primary care data as of 2023-04-14</p>"},{"location":"genes-and-health-tre-documentation/#what-do-the-raw-data-look-like","title":"What do the raw data look like","text":"<p>This section describes the raw phenotype files currently available in the TRE, and their location in the TRE file structure. Column headings are replicated directly, brief summaries of file contents and column contents will be updated.</p> <p>For most users and use cases, this documment should serve as a reference guide only. Members of the GH data team have used the raw files described here to produce curated products, that will in most cases be more useful (and user friendly).</p> <p>/genesandhealth/library-red/genesandhealth/phenotypes_rawdata/DSA__BartsHealth_NHS_Trust/2021_04_PathologyLab/AntiMullerianHormone_April2021.csv</p> PseudoNHSNo Age At Test Test Name Date of Test Result Unit Type description here Type description here Type description here Type description here Type description here Type description here"},{"location":"genes-and-health-tre-documentation/#phenotype-curation-(under-construction)","title":"Phenotype Curation (UNDER CONSTRUCTION)","text":"<p>This page provides a few examples of how the raw health data in the TRE have been curated to produce useful output for a range of analyses. The files used in the examples below are all located in genesandhealth/library-red, please see the page describing TRE file structures for further information. An overview of the different datafiles are available in the raw phenotype data page</p>"},{"location":"genes-and-health-tre-documentation/#tools","title":"Tools","text":"<p>The philosophy of the Genes and Health project is to provide researchers with the tools to generate their own phenotypes as well as providing a curated set of phenotypes.</p> <p>The curated phenotypes are generated using the tre-tools package, which is a custom package developed by the Data Team. A curated phenotype is a phenotype that has been generated using a set of codelists that have been checked and validated by researchers in Genes and Health.</p> <p>The code is available at tre-tools. We strongly recommend that you use this package to generate your own phenotypes, as the code has been generated by the Data Team using a software engineering approach, and has been thoroughly tested.</p>"},{"location":"genes-and-health-tre-documentation/#codelists","title":"Codelists","text":"<p>There are a number of codelists available in the TRE that can be used to generate phenotypes. These are stored in the library-red folder. The codelists are stored in a folder called codelists and are named according to the phenotype they are used to generate.</p> <p>Codelists are simple csv files that contain the codes that are used to generate the phenotype. If you wish to use your own codelist, simply utilise the provided clipboard functionality, allowing you to transfer text data, such as CSV files, from your local machine to the TRE.</p> <p>In order to make sure that analyses are only carried out with codelists that have the expected structure (i.e. the correct format for ICD10), the Data Team have created a set of tools in tre-tools that can be used to check the codelists.</p> <p>The tool checks that all codes in the codelist conform to the expected format, and that there are no duplicate codes. For example, checking that a SNOMED codelist only contains SNOMED codes which have the format of a numerical value between 6 and 18 digits in length.</p>"},{"location":"genes-and-health-tre-documentation/#example-code","title":"Example code","text":"<p>The following code loads a codelist called Diabetes.</p> <p>diabetes.csv</p> code,term\u000b\"100000001\",\"Type 2 Diabetes\"\u000b\"100000002\",\"Diabetic Review\" from tretools.codelists.codelist_types import CodelistType\u000bfrom tretools.codelists.codelist import Codelist\u000b\u000b# Load the codelist\u000bdiabetes \\= Codelist(\"diabetes.csv\", CodelistType.SNOMED.value) <p>In the example above, we have loaded a codelist called diabetes.csv which contains two SNOMED codes. The Codelist class is used to load the codelist, and the CodelistType enum is used to specify the type of codelist. In this case, the codelist is a SNOMED codelist. If any of the codes in the codelist do not conform to the expected format, an error will be raised.</p> <p>For more information on how to use the tre-tools package, please see the tre-tools documentation, and the test files in the tre-tools repository for examples of how to use the package. We welcome any feedback on the package, and are happy to help with any issues you may encounter.</p>"},{"location":"genes-and-health-tre-documentation/#binary-traits","title":"Binary Traits","text":"<p>Binary traits are those that have two possible outcomes, such as disease status (e.g. diabetes, hypertension). A person either has the disease or they do not.</p> <p>The raw health data in the TRE is curated to produce binary traits for a range of analyses. The files used in the examples below are all located in genesandhealth/library-red. There is a lengthy readme file in the folder that describes the data in detail, along with timestamps for when the data was last updated. We recommend that you read this file before using the data.</p> <p>The binary traits data was generated using the tre-tools custom package. The code is available at tre-tools. The data has been cleaned and processed for use in a range of analyses. The data includes all the primary care and hospital data for the Genes and Health cohort, and has been processed and saved in a format that is easy to use for different types of analyses. The cleaning processes are described in the README file in the folder but in summary:</p> <ul> <li>Each data file has been loaded and de-duplicated on the basis of the unique identifier for each patient, date and code.  </li> <li>All datasets of the same coding system (for example, ICD10) have been merged into a single dataset for each \"time cut\" of data received.  </li> <li>All datasets have been merged into a single dataset for each coding system.</li> </ul> <p>Binary trait reports are generated using the tre-tools package and use ProcessedDataset and Codelist classes to generate a PhenotypeReport object. The PhenotypeReport object can then be used to generate a range of reports for the binary traits, including Regenie input files.</p>"},{"location":"genes-and-health-tre-documentation/#example-workflow","title":"Example workflow","text":""},{"location":"genes-and-health-tre-documentation/#example-code-1","title":"Example code","text":""},{"location":"genes-and-health-tre-documentation/#quantitative-traits","title":"Quantitative traits","text":""},{"location":"genes-and-health-tre-documentation/#codelists-1","title":"Codelists","text":""},{"location":"genes-and-health-tre-documentation/#example-workflow-1","title":"Example workflow","text":""},{"location":"genes-and-health-tre-documentation/#example-code-2","title":"Example code","text":""},{"location":"genes-and-health-tre-documentation/#how-to-get-help","title":"How to get Help","text":"<p>Users and Administrators can get help in a number of ways:</p> <ol> <li>Genes &amp; Health Industry Consortium users - use the Microsoft Teams chat  </li> <li>Genes &amp; Health Internal users - use the Slack chat  </li> <li>Software issues - raise a ticket by emailing hgi@sanger.ac.uk with your request, rather than using Slack/Teams - this ensures the request is properly logged and can be tracked.  </li> <li>Documentation - if you have a question about the documentation, or would like to suggest an improvement, please raise an issue on the documentation through email.</li> </ol>"},{"location":"getting-started-as-a-new-user/","title":"Getting started as a new user","text":""},{"location":"getting-started-as-a-new-user/#steps-to-get-access","title":"Steps to get access","text":"<ul> <li> <p>All users must read and accept the Genes &amp; Health Code of Conduct.</p> </li> <li> <p>All users must complete the NHS Data Security Awareness Level 1 training before they're granted access to Genes and Health data.</p> </li> </ul> <p>Users with an academic email address (.ac.uk) or an NHS email address (@nhs.net) can register for the NHS Data Security Awareness Level 1 training at e-learning for Healthcare.  </p> <p>Wellcome Sanger Institute employees</p> <p>If you're a Wellcome Sanger Institute employee, please use ODS Code 8J947 and select Genome Research Limited from the list of organisations when you register for the course.  </p> <p>Non-academic users can register and pay (about \u00a330) for the training course at eIntegrity Healthcare e-learning. Genes &amp; Health industry consortium users can request a pre-paid link to eIntegrity from us.</p> <p>After completing the NHS Data Security Awareness Level 1 training course, all users must attest to the Genes &amp; Health Code of Conduct and upload their certificate to Genes &amp; Health new user registration system. Please contact Genes and Health at genesandhealth@qmul.ac.uk for instructions on how to access the new user registration system.  </p> <p>These steps are important for our  NHS Digital Data Security and Protection Toolkit, and ISO 27001 accreditation.  </p> <p>Caution</p> <p>Users who have not completed the Data Security Awareness training or attested to the Code of Conduct are subject to having their account deactivated.</p>"},{"location":"getting-started-as-a-new-user/#setting-up-a-profile","title":"Setting up a profile","text":"<p>When first set up, users will get an email from Google (to their normal email address). This will have a username@genesandhealth.qmul.ac.uk username. You need to Add this as a Profile in Google Chrome. Please do not try to use any other browser than Google Chrome!  </p> <p>Note</p> <p>This username is not an email address, and we will not send email to it. It cannot receive email; it is just a username for the TRE.  Once you have done this, go to Manage Your Account and Security and turn 2 Step Verification on. You will need to enter a phone number and get a code by SMS/text message. You cannot access the TRE without this enabled.</p>"},{"location":"getting-started-as-a-new-user/#starting-the-tre","title":"Starting the TRE","text":"<p>Having selected your username@genesandhealth.qmul.ac.uk account as your Chrome Profile, enter the G&amp;H TRE\u2019s URL in your Chrome browser. Your URL will start with https://new-production.genesandhealth.qmul.ac.uk/. The full URL is dependent on your sandbox and can be obtained from the table below. This will take you to the TRE login page. You will be asked to enter your username and password. The username is the one you have been given by the Genes and Health team, and the password is the one you have set up when you first logged in. If you want to go a specific sandbox, you can use the following URL table:</p> Sandbox URL Sandbox 1 - QMUL +WSI Core Team Desktop https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-1/vm Sandbox 2 - External Academic Desktop https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-2/vm Sandbox 3 - GSK Desktop https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-3/vm Sandbox 4 - BMS Desktop https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-4/vm Sandbox 5 - MSD Desktop https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-5/vm Sandbox 6 - Takeda Desktop https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-6/vm Sandbox 7 - Pfizer Desktop https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-7/vm Sandbox 8 - S00050_FFAIR-PRS Desktop https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-8/vm Sandbox 9 - Maze Therapeutics Desktop https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-9/vm Sandbox 10 - Novo Nordisk Desktop https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-10/vm Sandbox  11 - University of Exter https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-11/vm Sandbox 13 - AstraZeneca https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-13/vm Sandbox 14 - External Academic, Consortium access https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-14/vm Sandbox 15 - 5 Prime Sciences https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-15/vm Sandbox 16 - Sandbox 16 https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-16/vm Sandbox 17 - Academic, NHS Digital access https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-17/vm"},{"location":"getting-started-as-a-new-user/#choosing-your-required-machine-configuration","title":"Choosing your required machine configuration","text":"<p>Once logged in, you will be taken to the Virtual Machines page where you can start a new machine or connect to an existing one.  You will be offered a variety of virtual machine types.  </p> <p>Warning</p> <p>Choose the Basic machine unless a script requires high memory or increased CPU capacity, and is ready to go. Test your script on the Basic machine first, as other options are more expensive.  </p> <p>Note</p> <p>Some machine types have many CPUs, which are suitable for multithreaded applications like plink or regenie that can fully utilise them. These applications may sometimes run input/output operations too quickly for standard Google bucket storage, requiring you to copy key files to faster local storage (see below).</p>"},{"location":"getting-started-as-a-new-user/#choosing-a-custom-machine-configuration","title":"Choosing a custom machine configuration","text":"<p>It is possible that sometimes you may require a Virtual Machine that offers resources different to the standard flavors i.e. higher-memory, higher-cpu or memory-optimised instances. You can choose a custom VM configuration from the Virtual Machines page by expanding the Use custom Virtual Machine profile section at the bottom. </p> <p>Warning</p> <p>Choose the Use custom Virtual Machine profile only when absolutely necessary, use Basic machine unless a script requires high memory or increased CPU capacity. Excess use of higher-spec machines can significantly impact running costs. Test your script on the Basic machine first, as other options are more expensive.</p>"},{"location":"getting-started-as-a-new-user/#switching-off-the-machine","title":"Switching off the machine","text":"<p>Your virtual machine will keep running for 24 hours if you are doing nothing. You can disconnect from Chrome, turn your laptop off, and then you will be straight back into the exact same machine when you connect again (within 24h). If you have Linux jobs running, the machine will keep going while these run (however long) plus another 48h.  </p> <p>Warning</p> <p>Keeping machines running in the background costs money. So please actively shutdown (if you do not need the extra 48h) using the \"Off\" button on the bottom of the side menu.</p>"},{"location":"getting-started-as-a-new-user/#gwas-training-video","title":"GWAS Training Video","text":"<p>Genes &amp; Health have provided a number of training videos to help researchers get started with the Trusted Research Environment (TRE). This is a 45-min tutorial in which GWAS using regenie is demonstrated (300Mb with mp4 format, updated 5 oct 2022). This video is a recording of a live demo session, and the quality may not be perfect. It is recommended to watch the video in full screen mode. Please feel free to download the video and watch it at your convenience. https://dl.dropboxusercontent.com/s/k6h5botp53xk3l6/TRE%20Training-20220928_160450-Meeting%20Recording.mp4?e=1\\&amp;dl=0</p>"},{"location":"getting-started-as-a-new-user/#gwas-example","title":"GWAS Example","text":"<p>You can find an example regenie script for binary trait GWAS below. Please feel free to adapt and reuse this script.</p> <p>Caution</p> <p>Please let your script run first on the cheap 2-core machine. Regenie has excellent multithreading capabilities and will perform best on the 64-core high-performance machine, but this option is expensive. The 2-core machine is sufficiently fast on a large multicore machine, allowing you to run it directly from the command line using a single all-chromosome pgen input file, without the need for HPC or splitting by chromosome. Regenie will utilise all available threads minus 1 by default, meaning the 64-core machine will run 63 times faster for the compute steps compared to the 2-core machine. It is fast enough on a large multicore machine to run several phenotypes. If you intend to run 1000 phenotypes, you will need to use Google HPC / WDL.</p> <pre><code>## RUN THIS FROM THE FOLDER WITH THE \n## COVAR/PHENO FILES AND WHERE YOU WANT THE OUTPUT\n\n## this is for BINARY TRAITS\n## remove the  --bt and firth etc options for quant traits, see the online regenie manual https://rgcgithub.github.io/regenie/options/\n\n## first copy big files to local storage ivm SSD for better i/o than with google storage buckets\n## regenie will sometimes crash if reading direct from library-red due to slow i/o\n## cp /genesandhealth/library-red/genesandhealth/GSAv3EAMD/Jul2021_44k_TOPMED-r2_Imputation_b38/topmed-r2_merged_version03/chrALLincX.dose.merged_INFO0.3_MAF0.00001_F_MISSING0.2.8bit.sorted.p* /home/ivm/Documents/\n\n## CHANGE THE DATE EACH RUN ## \ndaterun=2022_07_20\n\ncovarfile=\"/genesandhealth/library-red/genesandhealth/GSAv3EAMD/Jul2021_44k_TOPMED-r2_Imputation_b38/GNH.44190.noEthnicOutliers.covariates.20PCs.tab\"\n## updated to covarfile with correct FID IID structure 15 July 2022\n\nphenofile=\"/genesandhealth/library-red/genesandhealth/phenotypes_curated/version005_2022_06/1stoccurrence_3digitICD10_1SNOMEDto1ICD10/2022_06_version005_3digitICD10_1to1_42029withbothICD10andGSAJul2021.txt\"\n\n## these are the custom phenotypes: \"/genesandhealth/library-red//genesandhealth/phenotypes_curated/version005_2022_06/custom/2022-06-15_big_regenie_phenoFile.txt\"\n\ngrmfile=\"/genesandhealth/library-red/genesandhealth/GSAv3EAMD/Jul2021_44k_TOPMED-r2_Imputation_b38/bfile_forSAIGEgrm_44396_chipgenotypes_indep-pairwise_500_50_0.2_LDpruned_NotChrY\"\n\n## regenie will run all phenotypes in the phenoFIle if you dont specify --phenoCol or --phenoColList\n\n## beware the .log file does not have phenotype name in its filename (because it is designed for running many phenotypes at once), can get overwritten if run multiple times using same $daterun\n\n## if want to run male-only or female-only analysis, best to use --keep with a list of individuals in Step1 Step2 rather than --sex-specific. Because sex-specific uses the sex in the bed or pgen files not from the covariate file. And sex is NA in the pgen file we have made\n\nregenie   \\\n  --step 1 \\\n  --bed \"$grmfile\" \\\n  --covarFile \"$covarfile\" \\\n  --phenoFile \"$phenofile\" \\\n  --phenoExcludeList PseudoNHS_2022_02_08 \\\n  --phenoCol ICD10__E10,ICD10__E11 \\\n  --minCaseCount 100 \\\n  --bsize 1000 \\\n  --bt \\\n  --lowmem \\\n  --lowmem-prefix tmp_rg \\\n  --gz \\\n  --verbose \\\n  --out \"$daterun\"_fit_binary_out\n\nregenie \\\n  --step 2 \\\n  --pgen /home/ivm/Documents/chrALLincX.dose.merged_INFO0.3_MAF0.00001_F_MISSING0.2.8bit.sorted \\\n  --covarFile \"$covarfile\" \\\n  --phenoFile \"$phenofile\" \\\n  --bsize 1000 \\\n  --minMAC 20 \\\n  --minINFO 0.6 \\\n  --bt \\\n  --firth --approx \\\n  --pThresh 0.01 \\\n  --pred \"$daterun\"_fit_binary_out_pred.list \\\n  --gz \\\n  --verbose \\\n  --out \"$daterun\"_GNH_binary_GWAS_firth\n\n## END ##\n</code></pre>"},{"location":"how-to-get-help/","title":"How to get Help","text":"<p>Users and Administrators can get help in a number of ways:</p> <ol> <li>Genes &amp; Health Industry Consortium users - use the Microsoft Teams chat  </li> <li>Genes &amp; Health Internal users - use the Slack chat  </li> <li>Software issues - raise a ticket by emailing hgi@sanger.ac.uk with your request, rather than using Slack/Teams - this ensures the request is properly logged and can be tracked.  </li> <li>Documentation - if you have a question about the documentation, or would like to suggest an improvement, please raise an issue on the documentation through email.</li> </ol>"},{"location":"how-to-increase-disk-size/","title":"How to increase disk size\u200b","text":""},{"location":"how-to-increase-disk-size/#how-to-increase-disk-size\u200b","title":"How to increase disk size\u200b","text":"<p>By default, your /home directory's disk size is 100G. If you need to increase the disk size of your /home directory for any reason, you can do so from the Virtual Machines page.</p> <ol> <li>Shutdown your VM if it is running.  </li> <li>While creating a new VM from the Virtual Machines page, click on the Resize home disk section to expand it.  </li> <li>Use the slider to adjust the disk size according to your needs.  </li> <li>Start the new VM with your preffered machine type.</li> </ol> <p>The /home disk will be extended to the new size and previous data will be retained.</p> <p></p> <p>Note: Please note that it is recommended to store long-term data in the red bucket and we advise to not treat the /home directory as your permanent storage location. Disk size can be increased upto 1000 GB.</p>"},{"location":"how-to-update-this-documentation/","title":"How to Update this Documentation","text":"<p>Welcome! This page is part of the documentation itself \u2014 and serves as your guide for contributing updates to it.</p> <p>The documentation is built using Material for MkDocs, a powerful and customisable static site generator for project documentation. Whether you\u2019re fixing typos, updating content, or adding entirely new sections, this guide will walk you through how to do it cleanly and effectively.</p> <p>Tip</p> <p>You should expect that when editing the documentation, the MkDocs server is already running in the background, so any changes you make will be reflected live as you save the files.</p>"},{"location":"how-to-update-this-documentation/#prerequisites","title":"\u2705 Prerequisites","text":"<p>Before you get started:</p> <ul> <li>You must have write access to the test-docs repository on GitHub.</li> <li>You do not need to branch or fork. This documentation encourages low-friction updates \u2014 just edit the files directly if you have access.</li> <li>If multiple people are working on documentation simultaneously, consider coordinating to avoid merge conflicts.</li> </ul>"},{"location":"how-to-update-this-documentation/#updating-existing-pages","title":"\u270f\ufe0f Updating Existing Pages","text":"<p>All content lives in Markdown (<code>.md</code>) files within the <code>docs/</code> directory.</p>"},{"location":"how-to-update-this-documentation/#steps","title":"Steps:","text":"<ol> <li>In test-docs, navigate to the documentation page you want to update.</li> <li>Click the  icon in the top right of the page.</li> <li>If prompted, sign in as a user with write access to the <code>test-docs</code> GitHub repo.</li> <li>You are now in edit mode (editing the .md file for that documentation page).</li> <li>Commit changes\u2026 when you are happy with the edits you have made.</li> </ol> <p>Tip</p> <p>Return to the page in the documentation where the changes were made. Wait a few seconds and then refresh the page in the browser. The changes should appear in place. </p>"},{"location":"how-to-update-this-documentation/#adding-images","title":"\ud83d\uddbc\ufe0f Adding Images","text":"<p>All image assets should live under the <code>docs/images/</code> folder of the <code>test-docs</code> repo. If an image for use exists elsewhere on the internet then (provided you have permission) make a copy and place it in <code>docs/images/</code>. This protects against referring in the docs to an image which has subsequently been moved or deleted externally. </p>"},{"location":"how-to-update-this-documentation/#how-to-include-images","title":"How to include images:","text":"<ol> <li>Upload your image file (e.g., <code>cool-manhattan-plot.png</code>) to <code>docs/images/</code> in the <code>test-docs</code> repo. Or a subfolder therein (e.g. <code>docs/images/regenie/</code>)</li> <li>refer to the image in your <code>.md</code> file like so:</li> </ol> <pre><code>![Cool Manhattan Plot](images/cool-manhattan-plot.png)\n</code></pre> <p>Images will automatically scale in most cases, but you can use Markdown extensions like <code>:width:</code> if needed (with proper plugin support).</p>"},{"location":"how-to-update-this-documentation/#creating-new-pages","title":"\ud83c\udd95 Creating New Pages","text":"<p>Want to add a new topic or guide?</p>"},{"location":"how-to-update-this-documentation/#1-create-a-new-file","title":"1. Create a new file","text":"<p>Place your new Markdown file into an appropriate location, such as:</p> <pre><code>docs/[my-new-documentation-feature]/integration.md\n</code></pre> <p>You can use an existing page as a template for structure and formatting.</p>"},{"location":"how-to-update-this-documentation/#2-add-to-navigation","title":"2. Add to Navigation","text":"<p>Edit the <code>mkdocs.yml</code> file at the root of this project to include your new page at the appropriate location in the site <code>nav</code>:</p> <pre><code>nav:\n  - Home: index.md\n  - Developer Guide:\n      - Integration: developer-guide/integration.md\n</code></pre> <p>YAML is whitespace-sensitive \u2014 use 2 spaces per indentation, not tabs!</p> <p>Info</p> <p>If you don\u2019t add your page to <code>mkdocs.yml</code>, it won\u2019t appear in the sidebar navigation.</p>"},{"location":"how-to-update-this-documentation/#markdown-extensions-and-best-practices","title":"\ud83e\udde9 Markdown Extensions and Best Practices","text":"<p>Material for MkDocs includes several powerful extensions:</p> <ul> <li>Callout boxes: <code>!!! note</code>, <code>!!! warning</code>, <code>!!! example</code>, etc.</li> </ul>"},{"location":"how-to-update-this-documentation/#example-adding-a-note-box","title":"Example: Adding a <code>note</code> box","text":"<p>Material for MkDocs calls these admonitions:</p> <pre><code>!!! note\n    You can add callouts like this to draw attention.\n</code></pre> <p>Which renders as:</p> <p>Note</p> <p>You can add callouts like this to draw attention.</p> <ul> <li>Code syntax highlighting:</li> </ul> <p>Here\u2019s how to display some python with syntax highlighting:</p> <pre><code>```python\ndef greet(name: pl.Utf8) -&gt; None:\n  print(f\"Hello, {name}\")\n```\n</code></pre> <p>Which appears in the documentation as:</p> <pre><code>def greet(name: pl.Utf8) -&gt; None:\n    print(f\"Hello, {name}\")\n</code></pre> <ul> <li>Internal linking:   <pre><code>[Read the Getting Started Guide](getting-started.md)\n</code></pre></li> </ul> <p>Use these features to make your contributions clearer and more engaging.</p>"},{"location":"how-to-update-this-documentation/#permissions","title":"\ud83d\udd12 Permissions","text":"<p>You\u2019ll need access to the following:</p> <ul> <li><code>docs/</code> \u2013 for Markdown pages</li> <li><code>docs/images/</code> \u2013 for images and diagrams</li> <li><code>mkdocs.yml</code> \u2013 to update navigation structure</li> </ul> <p>If you're missing access, contact a maintainer or administrator.</p>"},{"location":"how-to-update-this-documentation/#final-checklist-before-committing","title":"\u2705 Final Checklist Before Committing","text":"<ul> <li>[ ] Proofread for spelling and grammar</li> <li>[ ] Image paths and links verified</li> <li>[ ] New pages added to <code>nav</code> in <code>mkdocs.yml</code></li> <li>[ ] Content renders correctly in local preview</li> <li>[ ] Used relevant MkDocs features (admonitions, syntax highlighting, etc.)</li> </ul>"},{"location":"how-to-update-this-documentation/#additional-resources","title":"\ud83d\udee0\ufe0f Additional Resources","text":"<ul> <li>Material for MkDocs documentation</li> <li>MkDocs User Guide</li> <li>Markdown Syntax Guide</li> </ul>"},{"location":"how-to-update-this-documentation/#need-help","title":"\ud83e\uddf5 Need Help?","text":"<p>Open a ticket, check the <code>README.md</code>, or reach out in the internal documentation channel.</p> <p>Happy writing!</p>"},{"location":"how-to-use-docker/","title":"How to use docker","text":"<p>Using singularity from the command line. Now enabled. First raise a ticket with hgi@sanger.ac.uk and ask for the docker image you want to be installed in the TRE. You then call the .sif image for your analysis. If your pipeline has other dependencies (i.e. needs R libraries, or reference datasets etc.) you need to do the set-up outside the TRE, zip and import through the airlock (you can't do the import step yourself). Once in the TRE and after the docker image is installed, you can run the docker from the command line with <pre><code>singularity shell /pathway/dockerimage.sif\n</code></pre></p> <p>Tip</p> <p>Do not forget you need to mount the directories you need for reading/writing within the singularity (i.e. -B).</p>"},{"location":"how-to-write-hash-symbols/","title":"How to write hash (<code>#</code>) symbols in the TRE","text":"<p>Apologies, this is a bit tricky! </p>"},{"location":"how-to-write-hash-symbols/#typing-directly","title":"Typing <code>#</code> Directly","text":"<p>Try these options:</p> OS / Layout Direct Key Combination Linux / Ubuntu (US layout) Shift + 3 Linux / Ubuntu (UK layout) AltGr + 3 macOS (US layout) Shift + 3 macOS (UK layout) Option + 3 Windows (US layout) Shift + 3 Windows (UK layout) AltGr + 3 <p>If the direct key isn\u2019t available or doesn\u2019t work in your environment try the next option:  </p>"},{"location":"how-to-write-hash-symbols/#raw-unicode-method","title":"Raw unicode method","text":"<ul> <li>Ubuntu / Linux (TRE) \u2192 Use Ctrl + Shift + U</li> </ul> <p>Tip</p> <p>You should see a \"u\" appear, underlined, at your cursor</p> <p>Type <code>23</code> followed by Enter </p>"},{"location":"how-to-write-hash-symbols/#if-the-above-methods-do-not-work","title":"If the Above Methods Do Not Work","text":""},{"location":"how-to-write-hash-symbols/#copypaste","title":"Copy/Paste","text":"<ul> <li>Copy the <code>#</code> character from an existing document/script already inside the TRE.</li> <li>Paste it where you need it.</li> </ul>"},{"location":"latest-tre-data-updates-and-changes/","title":"Latest TRE data updates and changes","text":"<p>(newest shown first)</p>"},{"location":"latest-tre-data-updates-and-changes/#2025-may-20-by-dvh","title":"2025-MAY-20 by DVH","text":"<p>Begun release of 55k exome ExWAS to Consortium1 partners. Quant traits initially, to be followed by binary traits.  <pre><code>gs://qmul-production-library-consortiumpriorityperiod-red\n\u2514\u2500\u2500 Callsets\n    \u2514\u2500\u2500 2024_05_55kCallset\n        \u2514\u2500\u2500 release_2025-JUN-16_ExWAS/\n</code></pre></p>"},{"location":"latest-tre-data-updates-and-changes/#2025-may-05-by-dvh","title":"2025-MAY-05 by DVH","text":"<p>Released 51k GSA-TOPMEDr3 GWAS results for v010 quant traits  <pre><code>gs://qmul-production-library-red\n\u2514\u2500\u2500 genesandhealth\n    \u2514\u2500\u2500 GSAv3EAMD\n        \u2514\u2500\u2500 Jan2024_51k_TOPMED-r3_Imputation_b38\n            \u2514\u2500\u2500 2025_05_v010_quantpy_GSATOPMEDr3_GWAS/\n</code></pre></p>"},{"location":"latest-tre-data-updates-and-changes/#2025-apr-28-by-rk","title":"2025-APR-28 by RK","text":"<p>Improved the file dialog that allows users to upload files to the red bucket. Users can now upload files to the red bucket in the directory of their choice and create a new directory in the red bucket if they wish.</p>"},{"location":"latest-tre-data-updates-and-changes/#2025-apr-24-by-dvh","title":"2025-APR-24 by DVH","text":"<p>More Barts Health datafiles from 2024_09 release redaacted and put in the TRE  <pre><code>gs://qmul-production-library-red\n\u2514\u2500\u2500 genesandhealth\n    \u2514\u2500\u2500 phenotypes_rawdata\n        \u2514\u2500\u2500 DSA__BartsHealth_NHS_Trust\n            \u2514\u2500\u2500 2024_09_ResearchDataset/\n</code></pre></p>"},{"location":"latest-tre-data-updates-and-changes/#2025-apr-24-by-dvh_1","title":"2025-APR-24 by DVH","text":"<p>New quant traits v010 uploaded:  <pre><code>gs://qmul-production-library-red\n\u2514\u2500\u2500 genesandhealth\n    \u2514\u2500\u2500 phenotypes_curated\n        \u2514\u2500\u2500 version010_2025_04/\n</code></pre></p>"},{"location":"latest-tre-data-updates-and-changes/#2025-mar-26-by-dvh","title":"2025-MAR-26 by DVH","text":"<p>Uploaded new NHS England (ex Digital) HES data. More datasets still to come. <pre><code>gs://qmul-production-library-nhsdigital-sublicence-red\n\u2514\u2500\u2500 DSA__NHSDigitalNHSEngland\n    \u2514\u2500\u2500 2025_03/\n</code></pre></p>"},{"location":"latest-tre-data-updates-and-changes/#2025-mar-26-by-dvh_1","title":"2025-MAR-26 by DVH","text":"<p>Uploaded new folder of gvcf files from exome sequencing. These are the input to variant joint calling. They are unfiltered samples and genotypes, do not use for genetic association studies!  <pre><code>gs://qmul-production-library-consortiumpriorityperiod-red\n\u2514\u2500\u2500 gvcfs/\n</code></pre></p>"},{"location":"latest-tre-data-updates-and-changes/#2025-mar-25-by-dvh","title":"2025-MAR-25 by DVH","text":"<p>Removal of some files in previous Barts Health phenotypes_raw datasets, and replacement with more highly redacted versions:  </p> <p>Deleted: <pre><code>gs://qmul-production-library-red\n\u2514\u2500\u2500 genesandhealth\n    \u2514\u2500\u2500 phenotypes_rawdata\n       \u2514\u2500\u2500 DSA__BartsHealth_NHS_Trust\n           \u2514\u2500\u2500 2024_09_ResearchDataset\n               \u2514\u2500\u2500 RDE_Measurements.ascii.redacted.tab\n</code></pre> Replaced with: <pre><code> gs://qmul-production-library-red\n \u2514\u2500\u2500 genesandhealth\n     \u2514\u2500\u2500 phenotypes_rawdata\n         \u2514\u2500\u2500 DSA__BartsHealth_NHS_Trust\n             \u2514\u2500\u2500 2024_09_ResearchDataset\n                 \u2514\u2500\u2500 RDE_Measurements.ascii.redacted2.tab\n</code></pre></p> <p>Deleted: <pre><code>gs://qmul-production-library-red\n\u2514\u2500\u2500 genesandhealth\n    \u2514\u2500\u2500 phenotypes_rawdata\n       \u2514\u2500\u2500 DSA__BartsHealth_NHS_Trust\n           \u2514\u2500\u2500 2023_12_ResearchDatasetv1.6\n               \u2514\u2500\u2500 GandH_Measurements__20240423.ascii.redacted.tab\n</code></pre> Replaced with: <pre><code>gs://qmul-production-library-red\n\u2514\u2500\u2500 genesandhealth\n    \u2514\u2500\u2500 phenotypes_rawdata\n       \u2514\u2500\u2500 DSA__BartsHealth_NHS_Trust\n           \u2514\u2500\u2500 2023_12_ResearchDatasetv1.6\n               \u2514\u2500\u2500 GandH_Measurements__20240423.ascii.redacted2.tab\n</code></pre></p> <p>Deleted: - we do not think this file is used at all, so have not replaced.  <pre><code>gs://qmul-production-library-red\n\u2514\u2500\u2500 genesandhealth\n    \u2514\u2500\u2500 phenotypes_rawdata\n       \u2514\u2500\u2500 DSA__BartsHealth_NHS_Trust\n           \u2514\u2500\u2500 2023_12_ResearchDatasetv1.6\n               \u2514\u2500\u2500 in-beta-testing\n                   \u2514\u2500\u2500 GH_RAW_Pathology__20231211.ascii.redacted.tab\n</code></pre></p> <p>Deleted: <pre><code>gs://qmul-production-library-red\n\u2514\u2500\u2500 genesandhealth\n    \u2514\u2500\u2500 phenotypes_rawdata\n       \u2514\u2500\u2500 DSA__BartsHealth_NHS_Trust\n           \u2514\u2500\u2500 2024_09_ResearchDataset\n               \u2514\u2500\u2500 RDE_Pathology.ascii.nohisto.redacted.csv\n</code></pre> Replaced with: <pre><code>gs://qmul-production-library-red\n\u2514\u2500\u2500 genesandhealth\n    \u2514\u2500\u2500 phenotypes_rawdata\n       \u2514\u2500\u2500 DSA__BartsHealth_NHS_Trust\n           \u2514\u2500\u2500 2024_09_ResearchDataset\n               \u2514\u2500\u2500 RDE_Pathology.ascii.nohisto.redacted2.csv\n</code></pre></p> <p>Deleted: <pre><code>gs://qmul-production-library-red\n\u2514\u2500\u2500 genesandhealth\n    \u2514\u2500\u2500 phenotypes_rawdata\n       \u2514\u2500\u2500 DSA__BartsHealth_NHS_Trust\n           \u2514\u2500\u2500 2023_12_ResearchDatasetv1.6\n               \u2514\u2500\u2500 GH_Pathology__20231218.ascii.nohisto.redacted.tab\n</code></pre> Replaced with: <pre><code>gs://qmul-production-library-red\n\u2514\u2500\u2500 genesandhealth\n    \u2514\u2500\u2500 phenotypes_rawdata\n        \u2514\u2500\u2500 DSA__BartsHealth_NHS_Trust\n            \u2514\u2500\u2500 2023_12_ResearchDatasetv1.6\n                \u2514\u2500\u2500 GH_Pathology__20231218.ascii.nohisto.redacted2.tab\n</code></pre></p>"},{"location":"module-manager-guide/","title":"Module Manager User Guide","text":"<p>Module Manager is a simple, user-friendly tool designed to help you manage Singularity-based software modules in your research or development environment.</p> <p>This guide will walk you through how to load, unload, inspect, and restore software modules using both the command-line interface (CLI) and the graphical user interface (GUI).</p>"},{"location":"module-manager-guide/#what-is-a-module","title":"What Is a Module?","text":"<p>A module is a self-contained package that includes:</p> <ol> <li>A Singularity container (singularity.sif) with the software</li> <li>A meta.yaml file describing:<ul> <li>What commands the module provides</li> <li>What packages are inside</li> </ul> </li> </ol> <p>Loading a module makes its commands available in your terminal \u2014 no need to deal with paths or environment variables. </p> <p>For example, if you load a module r-ggplot, this will expose a R command in your terminal (replacing the default R command). When you run the R command from your terminal, the R environment from that module/container will effectively be in use and any bundled packages in the container are available. From the user's perspective, it works similar to using native R installation.</p>"},{"location":"module-manager-guide/#getting-started","title":"Getting Started","text":"<p>You can interact with the Module Manager in two ways:</p> <ol> <li>Terminal (CLI): For users who prefer scripting or command lines.</li> <li>Graphical Interface (GUI): Simplest, for those who want a more intuitive, click-friendly experience.</li> </ol>"},{"location":"module-manager-guide/#gui-usage","title":"GUI Usage","text":"<p>You can find the \u2018Module Manager\u2019 application icon on your desktop. You can also find it from the top-left drop-down menu (Applications &gt;&gt; Genes &amp; Health):</p> <p></p> <p>Once you have launched the application, the interface will look like this:</p> <p></p> <p>Search Modules (Top): Use the search bar to filter modules by name. You can start typing keywords in the search bar to find available packages.</p> <p>Available Modules (Left Panel): Displays a list of all the available modules.</p> <p>Module Description (Bottom Left Panel): When you click on a module from the \u2018Available Modules\u2019 panel, a module description will appear in this panel. The description will usually include following information:     - A general description of the module and its intent.     - Packages Included: A list of packages installed and available in the module.     - Commands Exported: A list of commands that the module will expose to the user terminal.</p> <p>Loaded Modules (Bottom Right Panel): Shows a list of the loaded modules along with the commands they expose.</p>"},{"location":"module-manager-guide/#actions","title":"Actions:","text":"<p>Load: Once you have selected a module from the \u2018Available Modules\u2019 panel, you can click the Load button to make the module's commands available in your shell. The loaded modules will now be shown in the \u2018Loaded Modules\u2019 panel at the bottom right along with the list of commands they expose.</p> <p></p> <p>Unload: After selecting a module from the \u2018Available Modules\u2019 panel, you can click on the Unload button to remove a module and its commands from your shell.</p> <p>Status: Check if a module is loaded, and view its details.</p> <p>Restore: Re-load all previously active modules (e.g., after a reboot).</p> <p>Unload All: Remove all active modules in one click.</p> <p>Note</p> <p>The modules in the \u2018Loaded Modules\u2019 panel appear in the LIFO order. If two loaded modules expose the same command (e.g. R), only the top-most (latest loaded) module is active and is available in the user terminal.</p> <p>In the following example, both R-SAIGE and R-aio expose the R command to the user terminal. However, as the R-SAIGE is the latest one (at top of the list), this is the effective module and typing the R command will load this module\u2019s R environment.</p> <p></p> <p>Once you have unloaded the last loaded module that exposes R (R-SAIGE), the previously loaded module (R-aio) will become active and now the R command from the terminal will point to the R-aio:</p> <p></p>"},{"location":"module-manager-guide/#cli-usage","title":"CLI Usage","text":"<p>If you're comfortable in the terminal, the module-manager CLI tool gives you precise control.</p>"},{"location":"module-manager-guide/#1-load-a-module","title":"1. Load a Module","text":"<pre><code>$ module-manager load &lt;module-name&gt;\n</code></pre> <ul> <li>Checks if the module is already loaded.</li> <li>Creates lightweight command wrappers in ~/.local/share/modules/bin/</li> <li>Lets you run module commands directly in your terminal.</li> </ul> <p>Example: <pre><code>$ module-manager load bcftools\n</code></pre></p> <p>Now you can simply run: <pre><code>$ bcftools view file.vcf\n</code></pre></p> <p>Under the hood, this command is being executed inside the corresponding Singularity container.</p>"},{"location":"module-manager-guide/#2-unload-a-module","title":"2. Unload a Module","text":"<pre><code>$ module-manager unload &lt;module-name&gt;\n</code></pre> <ul> <li>Removes the command wrappers for the module</li> <li>Updates your \"loaded modules\" list</li> </ul> <p>Example: <pre><code>$ module-manager unload bcftools\n</code></pre></p>"},{"location":"module-manager-guide/#3-restore-all-modules","title":"3. Restore All Modules","text":"<pre><code>$ module-manager restore\n</code></pre> <p>Use this after a logout/reboot to restore all previously loaded modules. Most of the time this won\u2019t be needed, as Module Manager preserves last state.</p>"},{"location":"module-manager-guide/#4-list-available-modules","title":"4. List Available Modules","text":"<pre><code>$ module-manager list-available\n</code></pre> <p>Shows all available modules.</p>"},{"location":"module-manager-guide/#5-list-currently-loaded-modules","title":"5. List Currently Loaded Modules","text":"<pre><code>$ module-manager list-loaded\n</code></pre> <p>Displays all modules you've loaded, along with the commands they expose.</p>"},{"location":"module-manager-guide/#6-check-module-status","title":"6. Check Module Status","text":"<pre><code>$ module-manager status &lt;module-name&gt;\n</code></pre> <p>Gives a detailed view of:   - Whether the module exists   - Whether it's loaded   - Which commands are available</p>"},{"location":"module-manager-guide/#7-unload-all-modules","title":"7. Unload All Modules","text":"<pre><code>$ module-manager unload-all\n</code></pre> <p>Removes all active modules and their command wrappers.</p>"},{"location":"module-manager-guide/#frequently-asked-questions","title":"Frequently Asked Questions","text":""},{"location":"module-manager-guide/#where-do-my-modules-come-from","title":"Where do my modules come from?","text":"<p>They live in /genesandhealth/library-red/modules. Your TRE admins maintain these.</p> <p>Tips</p> <p>You can load multiple modules at once. They won't interfere with each other unless they export the same command names.  Use status before loading or unloading a module to see what's going on.</p>"},{"location":"module-manager-guide/#need-help","title":"Need Help?","text":"<p>If you're facing issues or want to request a new module, contact your TRE system administrator or support team (hgi@sanger.ac.uk).</p>"},{"location":"sandboxes-and-what-each-sandbox-can-access/","title":"Sandboxes and what each sandbox can access","text":"<p>You will likely only have access to one sandbox for your project/institution/company and this is likely to be shared with some other users. However, some users will have access to multiple sandboxes. These can be viewed and switched between in the top right menu.</p> <p>Only selected sandboxes have access to the WDL high-performance compute pipelines. Currently, we will enable pipelines for sandboxes only if you provide your own Google Cloud Billing Account. In this case, you are responsible for any excess or inadvertent spend.</p> Sandbox number Sandbox name Industry Consortium1 buckets access NHS England data bucket access WDL Pipelines access GCP Billing Account code and name 1 QMUL + WSI Core Team yes yes yes begins 01E01\u2026 \u201cSanger Main Billing Account\u201d 2 External Academics no no no begins 01936\u2026 \u201cQMUL - Genes &amp; Health - CTS\u201d 3 GSK yes no no begins 01E01\u2026 \u201cSanger Main Billing Account\u201d 4 BMS yes no no begins 01E01\u2026 \u201cSanger Main Billing Account\u201d 5 MSD yes no no begins 01E01\u2026 \u201cSanger Main Billing Account\u201d 6 Takeda yes no no begins 01E01\u2026 \u201cSanger Main Billing Account\u201d 7 Pfizer yes no no begins 01E01\u2026 \u201cSanger Main Billing Account\u201d 8 S00050_FFAIR-PRS (NIH grant, PI Pradeep Natarjan) no no no begins 00EE8\u2026 \u201cBroad Institute - 5001256 (Primed-4)\u201d 9 Maze Therapeutics yes no no begins 01E01\u2026 \u201cSanger Main Billing Account\u201d 10 Novo Nordisk yes no no begins 01E01\u2026 \u201cSanger Main Billing Account\u201d 11 University of Exeter no yes no begins 01241\u2026 \u201cG+H Billing Account\u201d ~~12~~ ~~Genomics PLC~~ ~~no~~ ~~no~~ ~~no~~ ~~project has finished, deleted~~ 13 AstraZeneca yes no yes begins 01650\u2026 \u201cBilling for astrazeneca.net\u201d 14 External Academic, Consortium Access yes no no begins 01936\u2026 \u201cQMUL - Genes &amp; Health - CTS\u201d 15 5 Prime Sciences no no no begins 01483\u2026 \u201cBrent\u2019s Billing Account\u201d 16 S00073 Levine Glastonbury no No no 0167D \u201cUCL_Adam_Levine\u201d 17 Academic, NHS Digital access no yes no begins 01936\u2026 \u201cQMUL - Genes &amp; Health - CTS\u201d"},{"location":"software%2C-modules%2C-requesting-installs/","title":"Software, modules, requesting installs","text":""},{"location":"software%2C-modules%2C-requesting-installs/#software-available","title":"Software Available","text":""},{"location":"software%2C-modules%2C-requesting-installs/#linux-command-line-software","title":"Linux command line software","text":"<p>A very comprehensive set of genomics and genetics software is available for running from the Linux Terminal command line. See also Appendix for example scripts.</p> <p>Some software has very good multithreading e.g. plink2 or regenie. If you run these on the 64 core ivm (please test on the cheap 2-core machine first) you can get performance quite close to high performance compute (HPC) for some medium sized applications, and you do not have to learn WDL scripts. Alternatively, true cloud HPC is available using WDL Pipelines (see below).</p>"},{"location":"software%2C-modules%2C-requesting-installs/#programming-languages","title":"Programming languages","text":"<p>There are a number of different languages available on the TRE including Python and R. We also have Bash as a shell program and command language.</p>"},{"location":"software%2C-modules%2C-requesting-installs/#python","title":"Python","text":"<p>It is worth noting that Python does not have the normal virtual environment setup that you might be used to. It is not possible to install packages using pip install as you would on your local machine as the TRE does not have internet access, and therefore cannot connect to the Python Package Index (PyPI), or a specific GitHub repository. Packages are installed by the Sanger Institute and are available to all users.</p> <p>Jupyter notebooks Jupyter is available in the Applications menu as graphical user interface and can also be run from the Linux command line, by running jupyter notebook in the terminal.</p> <p>VS Code The VS Code editor is available in the Applications menu as graphical user interface and via the command line by using code .. It has limited plugins available as they must be specifically requested and installed by the Sanger Institute. The Jupyter notebook plugin is already installed.</p> <p>Any commands or scripts that rely on outside software will not work in the VS Code terminal unless the software is installed in the Linux command line. For example, Github Co-pilot will not work in the VS Code terminal.</p>"},{"location":"software%2C-modules%2C-requesting-installs/#r","title":"R","text":"<p>RStudio is available in the Applications menu as a graphical user interface for programmers interested in R language. It can be launched from the command line via rstudio.</p>"},{"location":"software%2C-modules%2C-requesting-installs/#instructions-for-specific-software","title":"Instructions for specific software","text":""},{"location":"software%2C-modules%2C-requesting-installs/#integrated-genome-viewer-igv","title":"Integrated Genome Viewer (IGV)","text":"<p>We have installed IGV to run from the Linux Terminal command line (not the web browser version). Make sure you are using the right genome fasta for your cram files, otherwise you will get an 'md5 error' (e.g. the default hg19 will not work with Wellcome Sanger Institute crams).</p> <p>Example for the 5236 Wellcome Sanger Institute low depth exomes:</p> <pre><code>/usr/local/bin/IGV\\_Linux\\_2.12.3/igv.sh \\\n--genome /genesandhealth/library-red/genesandhealth/exome\\_seq/2019\\_11\\_\\_5236\\_GNHonly/crams/hs38DH.fa\u000b/genesandhealth/library-red/genesandhealth/exome\\_seq/2019\\_11\\_\\_5236\\_GNHonly/crams/sc\\_autozygELGH6823965.cramb \n</code></pre> <p>The default set of (hg19) files for IGV are found here</p> <pre><code>/genesandhealth/library-green/sanger/igv/ \n</code></pre>"},{"location":"software%2C-modules%2C-requesting-installs/#libreoffice","title":"LibreOffice","text":"<p>LibreOffice provides equivalents for Microsoft Excel, Powerpoint, Word etc and is available in Applications menu as graphical user interface (not from Linux command line).</p>"},{"location":"software%2C-modules%2C-requesting-installs/#git","title":"Git","text":"<p>Git is available from the Linux command line for single user use and has some limited integration with RStudio and Jupyter Notebooks. However, given the fact that the TRE does not have internet access and everyone is signed in as the same user, Git's use is limited. This may change in the future.</p>"},{"location":"software%2C-modules%2C-requesting-installs/#file-browser-shortcuts","title":"File browser shortcuts","text":"<p>The file browser for Xfce is called 'Thunar'. Settings and defaults should persist between sessions but do not always.</p> <p>Detailed view: ctrl + 2  New tab: ctrl + T (only works if the TRE is in fullscreen mode - Chrome will create a new tab otherwise)</p>"},{"location":"software%2C-modules%2C-requesting-installs/#how-to-get-new-software-installed","title":"How to get new software installed","text":""},{"location":"software%2C-modules%2C-requesting-installs/#software-request","title":"Software request","text":"<p>Only admins can install new software. As there is no internet access, this also includes CRAN, github, PyPI etc. To get a new software installed, please raise a help desk request. This is done by emailing hgi@sanger.ac.uk to generate a ticket. This will take a few days to a week to complete.</p> <p>Note: Please note that if you wish to use a package that relies on an external service, such as a database or reference data, you will need to make sure that this data is also available on the TRE. This is because the TRE does not have internet access and cannot connect to external services.</p>"},{"location":"software%2C-modules%2C-requesting-installs/#developer-requests","title":"Developer requests","text":"<p>If you are a developer and want to install custom software, for example, a python package that you have written, you can request this to be installed by the Sanger Institute. It will be available to all users. This may require some additional information to be provided to the Sanger Institute particularly around security and data protection.</p>"},{"location":"what-genetic-and-health-data-is-where/","title":"What genetic and health data is where?","text":""},{"location":"what-genetic-and-health-data-is-where/#tre-identifiers","title":"TRE identifiers","text":"<p>There are two identifiers in the G&amp;H TRE which allow data linkage (e.g. genomic data to binary traits):</p> <ol> <li>PseudoNHS number: these 64-character alpha-numeric strings serves as a unique identifier for individuals and are used for health data and phenotype identification.</li> <li>OrageneID: these 14-digit strings serves as an identifier for saliva tube DNA IDs.</li> </ol> <p>Warning</p> <p>Multiple samples may be collected from the same individual, resulting in a many-to-one relationship between Oragene ID and PseudoNHS number.</p>"},{"location":"what-genetic-and-health-data-is-where/#gsa-and-exome-data-identifiers-assay-ids","title":"GSA and Exome data identifiers (assay IDs)","text":"<p>Genetic assays, such as exome sequencing or GSA chip analysis, are assigned assay IDs. </p> <p>For GSA chip analysis, the assay ID consists of the OrageneID concatenated with the Illumina chip ID and row position, e.g. 12345678901234_201234567890_R00C00.</p> <p>Exome sequencing assay IDs follow the format GNH-12345678901234_2, with the suffix accommodating multiple assays of a single Oragene ID. Multiple or repeated assays may be conducted on the same Oragene ID.</p>"},{"location":"what-genetic-and-health-data-is-where/#linking-genetic-assays-and-health-data","title":"Linking genetic assays and health data","text":"<p>There is a file linking OrageneIDs/assay IDs (for genetics &amp; questionnaire data) with PseudoNHS numbers (for NHS e-health record data and stage-1 questionnaire data). This file may get updated and re-dated:</p> <pre><code>/library-red\n\u2514\u2500\u2500 genesandhealth\n    \u2514\u2500\u2500 2025_02_10__MegaLinkage_forTRE.csv\n</code></pre> <p>Info</p> <p>Within the TRE community, this file is simply referred to as the MegaLinkage file or even sometime Megalinkage\u2122 </p>"},{"location":"what-genetic-and-health-data-is-where/#tre-folders-and-what-is-in-them","title":"TRE folders and what is in them","text":"<p>Warning</p> <p>This section is quite out of date and needs updating 2025-09-18</p> <p>Please see the <code>README</code> files in each folder for detail.</p>"},{"location":"what-genetic-and-health-data-is-where/#illumina-gsav3eamd-genotyping-chip-and-topmed-r2-imputation-data","title":"Illumina GSAv3EAMD genotyping chip and TOPMed-r2 imputation data:","text":"<pre><code>/library-red/genesandhealth/GSAv3EAMD/\n</code></pre>"},{"location":"what-genetic-and-health-data-is-where/#exome-sequencing-data","title":"Exome sequencing data","text":"<p>As of February 2022 n=5236 low/mid depth samples sequenced at Wellcome Sanger Institute and funded by Wellcome Sanger Institute are available. Both aligned cram files and callset vcfs are available. The file <code>5236_cram_IDlinkage.xlsx</code> links Oragene IDs with multiple ID types used by Wellcome Sanger Institute. Industry Consortium funded exome sequencing data on the full 50,000+ Genes &amp; Health volunteer cohort during 9 month post datafreeze priority period will only be available in /consortiumpriorityperiod-library-red/ After the priority period data will go into:</p> <pre><code>/library-red/genesandhealth/exome_seq/ \n</code></pre>"},{"location":"what-genetic-and-health-data-is-where/#curated-phenotypes-aka-binary-traits","title":"Curated phenotypes (aka binary traits)","text":"<p>Phenotypes which have been manually or automatically curated for consistency:</p> <pre><code>/library-red/genesandhealth/phenotypes_curated/ \n</code></pre> <p>See also this document which has data descriptions, case counts, and phenotype codelists.</p>"},{"location":"what-genetic-and-health-data-is-where/#raw-phenotype-data","title":"\"Raw\" phenotype data","text":"<p>'Raw' phenotype and health record data (NHS numbers pseudonymised, and de-identified of names, postcodes, dates of birth etc).</p> <pre><code>/library-red/genesandhealth/phenotypes_rawdata/\n</code></pre> <p>Data are organised by provider and data sharing agreement. This is so we can easily change access if any of the terms of data sharing change.</p> <p>Warning</p> <p>Please note as of Feb 2023, we do not yet have permission from NHS Digital to put their data in the TRE. An amendment is awaited.</p> <p>A reference for the NHS Digital Data Model and dictionary can be found on NHS Digital reference.</p>"},{"location":"what-genetic-and-health-data-is-where/#publicly-available-data","title":"Publicly available data","text":"<p>The genesandhealth folder contains downloadable data 'publicly' available to users (read-only):</p> <pre><code>/library-green/genesandhealth/\n</code></pre>"},{"location":"what-is-a-tre/","title":"What is a TRE ?","text":"<p>A TRE is a Trusted Research Environment.  Many large genetics and health data studies such as Finngen, UK Biobank, Genomics England are using TREs. NHS England and Health Data Research UK are strongly supporting this model. </p>"},{"location":"what-is-a-tre/#is-a-tre-the-same-as-a-secure-data-environment","title":"Is a TRE the same as a Secure Data Environment?","text":"<p>Probably! Many think of Trusted Research Environments and Secure Data Environments (SDEs) as synonymous, some don't (although the differences are subtle).  NHS England's secure data and research analysis platform was rebranded from \"NHS Digital\u2019s Trusted Research Environment (TRE) service for England\" to the NHS Secure Data Environment (SDE) (itself a part of an interoperable NHS Research Secure Data Environment network). </p> <p>At present, the Genes &amp; Health  secure data and research analysis platform remains identified as a TRE </p> <p>Tip</p> <p>It's probably not worth worrying about such things anyway.</p>"},{"location":"what-is-a-tre/#what-defines-a-tre","title":"What defines a TRE?","text":"<p>The essential qualities of a TRE are:</p> <ul> <li>The TRE restricts access to data inside the TRE to authenticated users, who are given access in a highly controlled manner  </li> <li>The TRE doesn\u2019t allow users to export data without inspection from the project\u2019s Data Controller or a delegate.  </li> <li>The TRE doesn\u2019t allow users to import code or data without inspection from the project\u2019s Data Controller or a delegate.</li> </ul> <p>Researchers must enter the secure environment of a TRE to work on the data inside, and cannot export summary results without inspection, to ensure no sensitive personal data is being exported --the researchers come to the data, the data do not go to the researchers.</p>"},{"location":"what-is-a-tre/#how-secure-is-the-genes-health-tre","title":"How secure is the Genes &amp; Health TRE?","text":"<p>In our case, many NHS Providers will not supply clinical data (including sensitive personal data) for G&amp;H participants unless G&amp;H can house the data in an ISO27001-certified TRE.  ISO 27001 is an internationally recognized standard that specifies the requirements for establishing, implementing, maintaining, and continually improving an Information Security Management System (ISMS).</p> <p>The Genes &amp; Health TRE is ISO/IEC 27001:2022 certified and NHS Data Security and Protection Toolkit registered (version 7; 30/06/2025)</p> <p></p> <p> </p>"},{"location":"getting-data-in-and-out-of-the-TRE/how-to-get-your-data-in/","title":"How to get your data in","text":"<p>Sometimes it is necessary to get data or code into the TRE. As the TRE is shut off from the internet this presents a challenge. This guide explains how to do this.</p>"},{"location":"getting-data-in-and-out-of-the-TRE/how-to-get-your-data-in/#copying-text-in","title":"Copying text in","text":"<p>A small amount of text can be pasted in from external systems using the Clipboard tool. This does not allow copy/paste out. This might be useful should you need to copy in a difficult to write function for example.</p> <p>First select the horizontal chevron on the left-hand-side of the TRE:</p> <p></p> <p>This will reveal the TRE tools:</p> <p></p> <p>Click on the \"Clipboard\" button:</p> <p></p> <p>Paste your external text/code/data (up to 10kB) into the text box using Ctrl-V (or Mac equivalent):</p> <p></p> <p>Go to a TRE terminal/text editor/application and paste in the external text using Ctrl-V (or Mac equivalent):</p> <p></p>"},{"location":"getting-data-in-and-out-of-the-TRE/how-to-get-your-data-in/#getting-user-data-into-the-tre","title":"Uploading user data into the TRE","text":"<p>You can upload data to your Sandbox specific green-uploads bucket, which you can find using the table below:</p> Sandbox Link to green-uploads bucket Sandbox 1 - QMUL +WSI Core Team Desktop https://console.cloud.google.com/storage/browser/qmul-production-sandbox-1_greenuploads Sandbox 2 - External Academic Desktop https://console.cloud.google.com/storage/browser/qmul-production-sandbox-2_greenuploads Sandbox 3 - GSK Desktop https://console.cloud.google.com/storage/browser/qmul-production-sandbox-3_greenuploads Sandbox 4 - BMS Desktop https://console.cloud.google.com/storage/browser/qmul-production-sandbox-4_greenuploads Sandbox 5 - MSD Desktop https://console.cloud.google.com/storage/browser/qmul-production-sandbox-5_greenuploads Sandbox 6 - Takeda Desktop https://console.cloud.google.com/storage/browser/qmul-production-sandbox-6_greenuploads Sandbox 7 - Pfizer Desktop https://console.cloud.google.com/storage/browser/qmul-production-sandbox-7_greenuploads Sandbox 8 - S00050_FFAIR-PRS Desktop https://console.cloud.google.com/storage/browser/qmul-production-sandbox-8_greenuploads Sandbox 9 - Maze Therapeutics Desktop https://console.cloud.google.com/storage/browser/qmul-production-sandbox-9_greenuploads Sandbox 10 - Novo Nordisk Desktop https://console.cloud.google.com/storage/browser/qmul-production-sandbox-10_greenuploads Sandbox  11 - University of Exter https://console.cloud.google.com/storage/browser/qmul-production-sandbox-11_greenuploads Sandbox 13 - AstraZeneca https://console.cloud.google.com/storage/browser/qmul-production-sandbox-13_greenuploads Sandbox 14 - External Academic, Consortium access https://console.cloud.google.com/storage/browser/qmul-production-sandbox-14_greenuploads Sandbox 15 - 5 Prime Sciences https://console.cloud.google.com/storage/browser/qmul-production-sandbox-15_greenuploads Sandbox 16 - Sandbox 16 https://console.cloud.google.com/storage/browser/qmul-production-sandbox-16_greenuploads Sandbox 17 - Academic, NHS Digital access https://console.cloud.google.com/storage/browser/qmul-production-sandbox-17_greenuploads <p>Once uploaded, please email hgi@sanger.ac.uk with the names of the files/directories you'd like to be transferred and which Sandbox you like them to be transferred to.</p> <p>Patient identifying data</p> <p>Please do not transfer any patient identifying data to the G&amp;H TRE, for example data containing patient names, NHS numbers, dates of birth, etc. </p> <p>Tip</p> <p>Please be aware at present, all users in your sandbox can see all data that is being stored in the green library. For this reason, it is important that you do not upload any data that you do not want other users to see.</p>"},{"location":"getting-data-in-and-out-of-the-TRE/requesting-data-out-of-the-TRE/","title":"Requesting data out of the TRE","text":""},{"location":"getting-data-in-and-out-of-the-TRE/requesting-data-out-of-the-TRE/#getting-your-results-out","title":"Getting your results out","text":"<p>You might be wondering how do I get my results of my analytical code out into the world so they can be used in publications or other studies.</p>"},{"location":"getting-data-in-and-out-of-the-TRE/requesting-data-out-of-the-TRE/#what-is-allowed-out?","title":"What is allowed out?","text":"<p>Individual level data is not allowed out of the TRE. Any data out requests are reviewed by the Genes &amp; Health core team to make sure they do not contain individual level data. Summary statistics, graphs etc are all usually fine. For more information, please read the below policy document:</p> <p>Download file: Policy - open disclosure of phenotypes and variants with counts and small numbers - v2.5</p>"},{"location":"getting-data-in-and-out-of-the-TRE/requesting-data-out-of-the-TRE/#existing-data","title":"Existing data","text":"<p>There are a number of files in library-green that are available for download. These do not need a request to be made.</p>"},{"location":"getting-data-in-and-out-of-the-TRE/requesting-data-out-of-the-TRE/#requesting-data","title":"Requesting data","text":"<p>You can make a request to download your results by right-clicking the file and selecting \"request file download\" for any file in:</p> <pre><code>/genesandhealth/red\n</code></pre> <p>or</p> <pre><code>/genesandhealth/pipeline\n</code></pre> <p>This sends an automated email to the Genes &amp; Health team. If you have not received a response within 48h please feel free to chase us up (e.g. by Slack). The team will copy the data to either /green (for users of your sandbox only, to be able to download) or to /library-green (for all users to be able to download)(see above). Please note that you can make one data out request per week.</p>"},{"location":"getting-data-in-and-out-of-the-TRE/requesting-data-out-of-the-TRE/#accessing-tre-data-from-external-systems/internet","title":"Accessing TRE data from external systems/internet","text":"<p>Users can download data from greendownloads or library-green using linux command line gcloud storage.</p> <p>Alternatively, you can use the web-interface for your Sandbox specific green-downloads bucket, you can find the link for your sandbox using the table below:</p> Sandbox Link to green-downloads bucket Sandbox 1 - QMUL +WSI Core Team Desktop https://console.cloud.google.com/storage/browser/qmul-production-sandbox-1_greendownloads Sandbox 2 - External Academic Desktop https://console.cloud.google.com/storage/browser/qmul-production-sandbox-2_greendownloads Sandbox 3 - GSK Desktop https://console.cloud.google.com/storage/browser/qmul-production-sandbox-3_greendownloads Sandbox 4 - BMS Desktop https://console.cloud.google.com/storage/browser/qmul-production-sandbox-4_greendownloads Sandbox 5 - MSD Desktop https://console.cloud.google.com/storage/browser/qmul-production-sandbox-5_greendownloads Sandbox 6 - Takeda Desktop https://console.cloud.google.com/storage/browser/qmul-production-sandbox-6_greendownloads Sandbox 7 - Pfizer Desktop https://console.cloud.google.com/storage/browser/qmul-production-sandbox-7_greendownloads Sandbox 8 - S00050_FFAIR-PRS Desktop https://console.cloud.google.com/storage/browser/qmul-production-sandbox-8_greendownloads Sandbox 9 - Maze Therapeutics Desktop https://console.cloud.google.com/storage/browser/qmul-production-sandbox-9_greendownloads Sandbox 10 - Novo Nordisk Desktop https://console.cloud.google.com/storage/browser/qmul-production-sandbox-10_greendownloads Sandbox  11 - University of Exter https://console.cloud.google.com/storage/browser/qmul-production-sandbox-11_greendownloads Sandbox 13 - AstraZeneca https://console.cloud.google.com/storage/browser/qmul-production-sandbox-13_greendownloads Sandbox 14 - External Academic, Consortium access https://console.cloud.google.com/storage/browser/qmul-production-sandbox-14_greendownloads Sandbox 15 - 5 Prime Sciences https://console.cloud.google.com/storage/browser/qmul-production-sandbox-15_greendownloads Sandbox 16 - Sandbox 16 https://console.cloud.google.com/storage/browser/qmul-production-sandbox-16_greendownloads Sandbox 17 - Academic, NHS Digital access https://console.cloud.google.com/storage/browser/qmul-production-sandbox-17_greendownloads <p>From your external system, ideally Linux server rather than laptop if you are downloading lots of data (e.g. our GWAS).</p> <p>Login to gcloud with:</p> <pre><code>gcloud auth login\n</code></pre> <p>Login with your username@genesandhealth.qmul.ac.uk that you use for TRE access from your browser. It is likely to ask you for 2 Factor Authentication either via phone or via a website link.</p> <p>From a multicore Linux server, and especially if you are trying to transfer lots of data/files</p> <pre><code>gcloud storage buckets list gs://qmul-sandbox-production-library-green/\n</code></pre> <p>To transfer file use:</p> <pre><code>gcloud storage cp &lt;local-file-path&gt; gs://&lt;bucket-name&gt;/&lt;destination-path&gt; \n</code></pre>"},{"location":"getting-started-as-a-new-user/choosing-your-virtual-machine/","title":"Choosing your required virtual machine (VM) configuration","text":"<p>Once logged in, you will be taken to the Virtual Machines (VM) page where you can start a new machine or connect to an existing one.  You will be offered a variety of virtual machine types.  </p> <p>Warning</p> <p>Choose the <code>Basic</code> machine unless a script requires high memory or increased CPU capacity, and is ready to go. Test your script on the <code>Basic</code> machine first, as other options are more expensive.  </p> <p>Note</p> <p>Some machine types have many CPUs, which are suitable for multithreaded applications like <code>plink</code> or <code>regenie</code> that can fully utilise them. These applications may sometimes run input/output operations too quickly for standard Google bucket storage, requiring you to copy key files to faster local storage (see Understanding TRE folders and buckets.</p>"},{"location":"getting-started-as-a-new-user/choosing-your-virtual-machine/#choosing-a-custom-machine-configuration","title":"Choosing a custom machine configuration","text":"<p>It is possible you may require a Virtual Machine that offers resources different to the standard flavors i.e. higher-memory, higher-cpu or memory-optimised instances. You can choose a custom VM configuration from the Virtual Machines page by expanding the Use custom Virtual Machine profile section at the bottom. </p> <p>Warning</p> <p>Choose the Use custom Virtual Machine profile only when absolutely necessary. Excess use of higher-spec machines can significantly impact running costs.</p>"},{"location":"getting-started-as-a-new-user/choosing-your-virtual-machine/#switching-off-the-machine","title":"Switching off the machine","text":"<p>Your virtual machine will keep running for 24 hours if you are doing nothing. You can disconnect from Chrome or Firefox (the reccommended browsers for the TRE), turn your laptop off, and then you will be straight back into the exact same machine when you connect again (within 24h). If you have jobs running, the machine will keep going while these run (however long) plus another 48h.  </p> <p>Warning</p> <p>Keeping machines running in the background costs money. So please actively shutdown (if you do not need the extra 48h) using the \"Off\" button on the bottom of the side menu or the <code>Shut down</code> option in the <code>Applications</code> menu.</p> <p> </p>"},{"location":"getting-started-as-a-new-user/sandboxes-and-what-each-sandbox-can-access/","title":"Sandboxes and what each sandbox can access","text":"<p>You will likely only have access to one sandbox for your project/institution/company and this is likely to be shared with some other users. However, some users will have access to multiple sandboxes. These can be viewed and switched between in the top right menu.</p> <p>Only selected sandboxes have access to the WDL high-performance compute pipelines. Currently, we will enable pipelines for sandboxes only if you provide your own Google Cloud Billing Account. In this case, you are responsible for any excess or inadvertent spend.</p> Sandbox number Sandbox name Industry Consortium1 buckets access NHS England data bucket access WDL Pipelines access GCP Billing Account code and name 1 QMUL + WSI Core Team yes yes yes begins 01E01\u2026 \u201cSanger Main Billing Account\u201d 2 External Academics no no no begins 01936\u2026 \u201cQMUL - Genes &amp; Health - CTS\u201d 3 GSK yes no no begins 01E01\u2026 \u201cSanger Main Billing Account\u201d 4 BMS yes no no begins 01E01\u2026 \u201cSanger Main Billing Account\u201d 5 MSD yes no no begins 01E01\u2026 \u201cSanger Main Billing Account\u201d 6 Takeda yes no no begins 01E01\u2026 \u201cSanger Main Billing Account\u201d 7 Pfizer yes no no begins 01E01\u2026 \u201cSanger Main Billing Account\u201d 8 S00050_FFAIR-PRS (NIH grant, PI Pradeep Natarjan) no no no begins 00EE8\u2026 \u201cBroad Institute - 5001256 (Primed-4)\u201d 9 Maze Therapeutics yes no no begins 01E01\u2026 \u201cSanger Main Billing Account\u201d 10 Novo Nordisk yes no no begins 01E01\u2026 \u201cSanger Main Billing Account\u201d 11 University of Exeter no yes no begins 01241\u2026 \u201cG+H Billing Account\u201d ~~12~~ ~~Genomics PLC~~ ~~no~~ ~~no~~ ~~no~~ ~~project has finished, deleted~~ 13 AstraZeneca yes no yes begins 01650\u2026 \u201cBilling for astrazeneca.net\u201d 14 External Academic, Consortium Access yes no no begins 01936\u2026 \u201cQMUL - Genes &amp; Health - CTS\u201d 15 5 Prime Sciences no no no begins 01483\u2026 \u201cBrent\u2019s Billing Account\u201d 16 S00073 Levine Glastonbury no No no 0167D \u201cUCL_Adam_Levine\u201d 17 Academic, NHS Digital access no yes no begins 01936\u2026 \u201cQMUL - Genes &amp; Health - CTS\u201d"},{"location":"getting-started-as-a-new-user/starting-the-tre/","title":"Starting the TRE","text":"<p>Browser choice</p> <p>Although the G&amp;H TRE might work with other browsers, we recommend using Chrome.</p> <p>Having selected your username@genesandhealth.qmul.ac.uk account as your profile for Chrome, enter the G&amp;H TRE\u2019s URL in your Chrome browser. Your URL will start with https://new-production.genesandhealth.qmul.ac.uk/.</p> <p>The full URL is dependent on your sandbox and can be obtained from the table below.  </p> <p>This will take you to the TRE login page. You will be asked to enter your <code>username</code> and <code>password</code>. The <code>username</code> is the one you have been given by the Genes and Health team, and the password is the one you have set up when you first logged in. If you want to go a specific sandbox, you can use the following URL table:</p> Sandbox URL Sandbox 1 - QMUL +WSI Core Team Desktop https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-1/vm Sandbox 2 - External Academic Desktop https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-2/vm Sandbox 3 - GSK Desktop https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-3/vm Sandbox 4 - BMS Desktop https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-4/vm Sandbox 5 - MSD Desktop https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-5/vm Sandbox 6 - Takeda Desktop https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-6/vm Sandbox 7 - Pfizer Desktop https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-7/vm Sandbox 8 - S00050_FFAIR-PRS Desktop https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-8/vm Sandbox 9 - Maze Therapeutics Desktop https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-9/vm Sandbox 10 - Novo Nordisk Desktop https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-10/vm Sandbox  11 - University of Exter https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-11/vm Sandbox 13 - AstraZeneca https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-13/vm Sandbox 14 - External Academic, Consortium access https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-14/vm Sandbox 15 - 5 Prime Sciences https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-15/vm Sandbox 16 - Sandbox 16 https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-16/vm Sandbox 17 - Academic, NHS Digital access https://new-production.genesandhealth.qmul.ac.uk/qmul-production-sandbox-17/vm"},{"location":"getting-started-as-a-new-user/steps-to-get-access/","title":"Getting access and setting up a profile","text":""},{"location":"getting-started-as-a-new-user/steps-to-get-access/#steps-to-get-access","title":"Steps to get access","text":"<ul> <li>All users must read and accept the Genes &amp; Health Code of Conduct.  </li> <li>All users must complete the NHS Data Security Awareness Level 1 training before they're granted access to Genes and Health data.</li> </ul> <p>Users with an academic email address (.ac.uk) or an NHS email address (@nhs.net) can register for the Data Security Awareness training at e-learning for Healthcare.  </p> <p>Wellcome Sanger Institute employees</p> <p>If you're a Wellcome Sanger Institute employee, please use ODS Code 8J947 and select Genome Research Limited from the list of organisations when you register for the course.  </p> <p>Non-academic users can register for the training course at eIntegrity Healthcare e-learning. After completing the NHS Data Security Awareness Level 1 training course, all users must attest to the Genes &amp; Health Code of Conduct and upload their certificate to Genes &amp; Health new user registration system. Please contact Genes and Health at genesandhealth@qmul.ac.uk for instructions on how to access the new user registration system. These steps are important for our  NHS Digital Data Security and Protection Toolkit, and ISO 27001 accreditation.  </p> <p>Caution</p> <p>Users who have not completed the Data Security Awareness training or attested to the Code of Conduct are subject to having their account deactivated.</p>"},{"location":"getting-started-as-a-new-user/steps-to-get-access/#setting-up-a-profile","title":"Setting up a profile","text":"<p>When first set up, users will get an email from Google (to their normal email address). This will have a username@genesandhealth.qmul.ac.uk username. You need to Add this as a Profile in Google Chrome. Please do not try to use any other browser than Google Chrome!  </p> <p>Note</p> <p>This username is not an email address, and we will not send email to it. It cannot receive email; it is just a username for the TRE.  Once you have done this, go to Manage Your Account and Security and turn 2 Step Verification on. You will need to enter a phone number and get a code by SMS/text message. You cannot access the TRE without this enabled.</p>"},{"location":"using-the-tre/handling-files-and-folders/","title":"Handling files and folders","text":"<p>There are four main scenarios to consider when using files and folders in the G&amp;H TRE:</p> <ol> <li>Moving files or folders from a GCS bucket to your <code>home</code> directory</li> <li>Moving files or folder from you <code>home</code> directory to the <code>red</code> GCS bucket</li> <li>Creating/renaming/moving/deleting files and folders in the <code>red</code> GCS bucket</li> <li>Creating/renaming/moving/deleting files and folders your <code>home</code> directory</li> </ol> <p>All operations mentioned in items 1, 2 and 3 above can be completed using <code>gcloud storage</code> commands.  All operations in item 4 can be performed using standard unix/linux shell commands (e.g. <code>cp</code>, <code>mv</code>, <code>rm</code>, <code>mkdir</code>) or the File Manager GUI.</p> <p>Reminders</p> <ul> <li>Google Cloud Services (GCS) buckets are explained in the \"Understanding TRE folders and buckets\" section.</li> <li><code>library-red</code> is a read-only bucket for TRE users, you cannot add to it or make any changes to it.</li> <li>Your <code>home</code> directory \"belongs\" to the virtual machine.  It behaves like a standar unix/linux files system. Its actual path is <code>/home/ivm/</code>. </li> </ul>"},{"location":"using-the-tre/handling-files-and-folders/#google-cloud-services-gcloud-storage","title":"Google Cloud Services\u2019 <code>gcloud storage</code>","text":""},{"location":"using-the-tre/handling-files-and-folders/#what-is-gcloud","title":"What is <code>gcloud</code>?","text":"<p><code>gcloud</code> is the Google Cloud Services' Command Line Interface (CLI): a set of tools to create and manage Google Cloud resources.  <code>gcloud</code> has multiple GROUPS which handle a specific aspect of the Google Cloud.  For example, <code>gcloud sql</code> handles the creation and management of Google Cloud SQL databases and <code>gcloud source</code> handles cloud git repository commands.</p> <p>The only gcloud GROUP of relevance to the G&amp;H TRE is the <code>storage</code> group.  <code>gcloud storage</code> handles the creation and management of Cloud Storage buckets and objects (files).</p> <p><code>gcloud storage</code> documentation can be found on <code>gcloud storage</code> reference website.</p> <p>What if I\u2019m using <code>gutils</code>?</p> <p>Some of you may have been using <code>gutils</code> to manage Cloud Storage buckets and objects.  The <code>gutils</code> commands are now deprecated. <p> \u26a0\ufe0f BE CAREFUL:</p> <ul> <li>Google states: \"Important: <code>gsutil</code> is not the recommended CLI for Cloud Storage. Use <code>gcloud storage</code> commands in the Google Cloud CLI instead.\"</li> <li>We advise you against using of <code>gutils</code>.  The <code>gsutil</code> tool does not support working with newer Google Cloud Storage\u2019s features such as soft delete.  This means that <code>gsutil</code> removes all versions of a file, whereas <code>gcloud storage</code> only removes the latest version.</li> <li>We have bucket versioning switched on in sandboxes as part of the backup strategy (so we can recover an old version of a file for users).  If you delete with <code>gutils</code>, we may not be able to recover the file(s).</li> </ul> <p>TL:DR</p> <p>Don't use <code>gutils</code></p>"},{"location":"using-the-tre/handling-files-and-folders/#fundamental-gcloud-storage-operations","title":"Fundamental <code>gcloud storage</code> operations","text":"<p>Reminder</p> <p>You need to identify GCS buckets using their Uniform Resource Locator (URL), for example, the URL for the <code>red</code> bucket on sandbox-1 is: <code>gs://qmul-production-sandbox-1-red/</code>.  URLs for G&amp;H TRE buckets are given in the \"What's in the bucket?\" section.</p> <p>Warning</p> <p><code>gcloud storage</code> can replicate common linux file and directory handling commands.</p> <ul> <li>These commands are powerful, you could easily accidentally delete entire directories or rewrite files.</li> <li>Do read the <code>gcloud storage</code> documentation.</li> <li>Consider backing up data before uploading or downloading it to/from a google bucket</li> <li>Favour copying over moving (at least one copy of your files should remain)</li> <li>Understand that the gcloud storage copy and move operations are non-atomic.  This means it is not an all or nothing (completes or doesn\u2019t complete) command; rather, it performs a copy from source to destination followed by, for move operations, deleting the each source object.  If the command does not complete, you may end up with some files copied/moved/renamed and others not.</li> <li>A consequence of this is that, in addition to normal network and operation charges, if you move a Nearline Storage, Coldline Storage, or Archive Storage object, deletion and data retrieval charges apply.</li> </ul>"},{"location":"using-the-tre/handling-files-and-folders/#creating-a-new-directory-in-red","title":"Creating a new directory (in <code>red</code>)","text":"<p>If you want to create a new directory in <code>red</code>, you must upload one into it. Remember that the concept of a directory does not rightly exist in Google cloud buckets.  Google bucket store files.  This means that you cannot just upload an empty directory into the <code>red</code> bucket.  If you try to do so, you will get the following error:</p> <p></p> <p>To successfully create a new directory or directory branch in <code>red</code> with <code>gcloud storage</code> you simply need to copy (or move) a file to the <code>red</code> bucket.  The simplest is often to create an empty file using the linux <code>touch</code> command.</p> <p></p> <p>Now copy this empty file using: <pre><code>gcloud storage cp [dummy_file] [destination/on/red/bucket/]\n</code></pre> So for example:</p> <p></p> <p>Do not forget to end the destination location with a <code>/</code> (forward-slash).  If you do not, you will copy <code>temp.txt</code> into a file called <code>JoeBloggs</code> on the <code>red</code> folder. </p> <p>You could also simply move the file using: <pre><code>gcloud storage mv [dummy_file] [destination/on/red/bucket/]\n</code></pre></p> <p>You can create further subdirectories by specifying them in the destination location.  For example, if you wanted to create <code>/red/JoeBloggs/Data/GWAS_data/Jan2024</code>, you would do the following:</p> <p></p> <p>You now have created all the (virtual) sub-directories along the way:</p> <p></p> <p>Please note that this will only upload new files or directories (as long as they contain at least one file or non-empty subdirectory) to the <code>red</code> bucket. Pre-existing files in <code>red</code> will not be affected.  For example, you can see that the <code>temp.txt</code> file we created in <code>/red/JoeBloggs/</code> when we used the <code>gcloud storage cp ./temp.txt gs://qmul-production-sandbox-1-red/JoeBloggs/</code> command is still there.  However, if you delete all files in a <code>red</code> bucket directory, you will also delete the virtual directory they are in.  </p> <p>In the example above, if you delete <code>/red/JoeBloggs/Data/GWAS_data/Jan2024/temp.txt</code>, you will lose directories <code>Jan2024</code>, <code>GWAS_data</code> and <code>Data</code> because all of these would end up empty.</p>"},{"location":"using-the-tre/handling-files-and-folders/#listing-all-buckets-and-files-ls-command","title":"Listing all buckets and files: <code>ls</code> command","text":"<pre><code>gcloud storage ls [PATH \u2026]\n</code></pre> <p>You can use wildcards to match multiple paths, e.g.</p> <pre><code>gcloud storage ls gs://qmul-production-sandbox-1-red/JoeBloggs/Data/GWAS_Data/Jan*/*.csv\n</code></pre> <p>This will list all <code>.csv</code> files in any directory in <code>GWAS_Data</code> which starts with <code>Jan</code> (e.g. <code>Jan2022</code>, <code>Jan2023</code>, <code>Jan2024</code>).</p>"},{"location":"using-the-tre/handling-files-and-folders/#uploading-downloading-and-copying","title":"Uploading, downloading, and copying","text":"<p>The general format is:</p> <pre><code>gcloud storage cp [SOURCE \u2026] DESTINATION\n</code></pre> <p>We have seen how to upload files to Google Cloud with <code>cp</code> above when learning how to create a directory.</p>"},{"location":"using-the-tre/handling-files-and-folders/#copying-an-entire-directory-tree-ie-directory-subdirectory-and-all-its-content","title":"Copying an entire directory tree (i.e., directory, subdirectory, and all its content)","text":"<p>Use the <code>--recursive</code> option to copy an entire directory tree. The following command \u201cuploads\u201d the directory tree <code>dir</code> to the red directory:</p> <pre><code>gcloud storage cp --recursive dir gs://qmul-production-sandbox-1-red\n</code></pre>"},{"location":"using-the-tre/handling-files-and-folders/#copying-to-your-current-local-directory","title":"Copying to your current (local) directory","text":"<p>In this example, the command will copy (\u201cdownload\u201d) all <code>.txt</code> files in <code>JoeBloggs</code> to your current local directory:</p> <pre><code>gcloud storage cp gs://qmul-production-sandbox-1-red/JoeBloggs/*.txt .\n</code></pre> <p>[Don\u2019t forget the <code>.</code> at the end.]</p>"},{"location":"using-the-tre/handling-files-and-folders/#moving-and-renaming","title":"Moving and renaming","text":"<p>The general template is:</p> <pre><code>gcloud storage mv [SOURCE \u2026] DESTINATION\n</code></pre>"},{"location":"using-the-tre/handling-files-and-folders/#moving-all-objects-from-a-local-directory-to-a-bucket","title":"Moving all objects from a local directory to a bucket","text":"<pre><code>gcloud storage mv ./dir gs://qmul-production-sandbox-1-red/JoeBloggs/\n</code></pre> <p>Note: All files will be moved from <code>./dir</code> to <code>/JoeBloggs/</code> (so will no longer be in <code>./dir</code>) but the <code>./dir</code> and any subdirectories in it will remain in the local directory.</p>"},{"location":"using-the-tre/handling-files-and-folders/#moving-all-objects-from-a-bucket-to-a-local-directory","title":"Moving all objects from a bucket to a local directory","text":"<pre><code>gcloud storage mv gs://qmul-production-sandbox-1-red/JoeBloggs/* dir\n</code></pre>"},{"location":"using-the-tre/handling-files-and-folders/#renaming-a-file","title":"Renaming a file","text":"<pre><code>gcloud storage mv gs://qmul-production-sandbox-1-red/JoeBloggs/old_name.txt gs://qmul-production-sandbox-1-red/JoeBloggs/new_name.txt\n</code></pre> <p>[Remember <code>old_name.txt</code> will be copied to <code>new_name.txt</code> and then <code>old_name.txt</code> will be deleted; if <code>old_name.txt</code> is very large, this may incur data charges.]</p>"},{"location":"using-the-tre/handling-files-and-folders/#alternative-to-gcloud-storage-1-the-upload-to-red-bucket-option-in-the-file-manager","title":"Alternative to <code>gcloud storage</code>: 1. the \u201cUpload to red bucket\u201d option in the File Manager","text":""},{"location":"using-the-tre/handling-files-and-folders/#uploading-a-file-to-red","title":"Uploading a file to <code>red</code>","text":"<p>To upload a file to <code>red</code> from another location (here my home folder on ivm), right click on the file and select \u201cUpload to red bucket\u201d.</p> <p></p> <p>A new window should pop-up documenting the outcome, for example:</p> <p></p> <p>However, this will upload to file to the top directory in <code>red</code>.  This is not recommended.  Rather you should upload your files into your personal or project <code>red</code> directory.</p>"},{"location":"using-the-tre/handling-files-and-folders/#creating-a-new-directory-in-red_1","title":"Creating a new directory in <code>red</code>","text":"<p>If you want to create a new directory in <code>red</code>, you must upload one into it.  Remember that a GCS simulated directory can only exists if it is accounted for by a file.  If you try to upload an empty directory from a different location to <code>red</code>, you will get the following error:</p> <p></p> <p>Your directory must contain at least one file to be uploaded to the <code>red</code> bucket.</p> <p>To create a new directory in <code>red</code>, first create an identically named directory in /home/ivm/ using one of the two methods below:</p> <p>Method 1: Creating a new directory and file in File Manager</p> <p>To create a directory and file to upload to <code>red</code> in File Manager, right-click in empty space and select \u201cCreate New Folder\u201d, then enter your folder name and click \u2018OK\u2019.</p> <p></p> <p>Now enter the new folder, right-click in empty space and select \u201cCreate Document / Empty File\u201d</p> <p></p> <p>Give the file whatever name you want and click \u201cCreate\u201d</p> <p></p> <p>You now have a folder called <code>JoeBloggs</code> which contains an (empty) file called <code>JB_dummy_file.txt</code>.</p> <p>Method 2: Creating a new directory and file in Terminal</p> <p>To create a new directory using the Terminal, first create a directory using the <code>mkdir</code> command, enter the directory with the <code>cd</code> command and create an empty file in this directory with the <code>touch</code> command as illustrated below.</p> <p></p> <p>Using either of the methods above, you should end up with the following directory on /home/ivm/:</p> <p></p> <p>Now navigate back to the <code>JoeBloggs</code> directory, right-click on the directory icon and select \u201cUpload to red bucket\u201d.</p> <p></p> <p>The <code>red</code> bucket now contains a (virtual) directory called <code>JoeBloggs</code> with the (empty) file <code>JB_dummy_file.txt</code>:</p> <p></p> <p>\u26a0\ufe0f BE CAREFUL, if you delete all files in a <code>red</code> bucket directory, you will also delete the virtual directory.  In this case, if you delete <code>JB_dummy_file.txt</code>, the <code>JoeBloggs</code> directory will disappear.</p>"},{"location":"using-the-tre/handling-files-and-folders/#creating-a-sub-directory-in-the-red-bucket","title":"Creating a sub-directory in the <code>red</code> bucket","text":"<p>To create a sub-directory in the <code>red</code> bucket, you need to create an identical directory tree in <code>/home/ivm/</code> (or another drive allowing this) and upload this to <code>red</code>. For example, suppose we wanted to create a JoeBloggs sub-directory called \u2018JB_data_dir\u2019 we would do the following:</p> <p></p> <p>And then navigate to the JoeBloggs directory in <code>/home/ivm/</code> and right-click \u201cUpload to red bucket\u201d:</p> <p></p> <p>You now have the (virtual) directory structure <code>/red/JoeBloggs/JB_data_dir/</code> in <code>red</code> with the file <code>JB_data_dir_dummy.txt</code> in the directory.</p> <p>Info</p> <ul> <li>this will upload any new file or directory in the /home/ivm/JoeBloggs/ directory, for example, if you added \u201cv_large_temp_file_that_should_definitely_not_be_moved.gz\u201d in the /home/ivm/JoeBloggs/ directory, this will be uploaded to <code>red</code></li> <li>the \u201cUpload to red bucket\u201d option will not replicate your /home/ivm/JoeBloggs/ directory to <code>red</code>, it will only upload new files or directories (as long as they contain at least one file) to the <code>red</code> bucket. For instance, if you delete <code>/home/ivm /JoeBloggs/JB_data_dir/</code> and then select \u201cUpload to red bucket\u201d for <code>/home/ivm /JoeBloggs/</code>, there will still be a <code>/red/JoeBloggs/JB_data_dir/</code> directory.</li> </ul>"},{"location":"using-the-tre/handling-files-and-folders/#moving-or-renaming-data-in-the-red-bucket","title":"Moving or renaming data in the <code>red</code> bucket","text":"<p>This is only possible using <code>gcloud storage</code>.</p>"},{"location":"using-the-tre/handling-files-and-folders/#alternative-to-gcloud-storage-2-mounting-the-red-bucket-onto-your-vm","title":"Alternative to <code>gcloud storage</code>: 2. Mounting the <code>red</code> bucket onto your VM","text":"<p>The <code>red</code> directory is currently available to the G&amp;H virtual machines as read-only and lacks some user permissions. The ability to upload files to a specific sub-directory, moving/editing files directly inside the <code>red</code> bucket, and creating a new directory inside <code>red</code> by using a terminal requires the use of the \u201ctricks\u201d described in Option 1 or the use of <code>gcloud storage</code> commands.  </p> <p>Currently, there is no other GCS space available as read/write. There are on-going discussions with the developers of TRE to make the use of buckets easier for collaboration and sharing and this will hopefully be improved in the future. As an alternative, you can mount a specific directory from <code>red</code> in your <code>home</code> directory.  </p>"},{"location":"using-the-tre/handling-files-and-folders/#what-is-mounting","title":"What is mounting?","text":"<p>Mounting is a process by which a computer's (or in our case, a virtual machine\u2019s) operating system makes files and directories on a storage device (such as hard drive, CD-ROM, or network shared drive) available for users to access via the computer's file system. When you mount a GCS bucket directory onto virtual machine, you are essentially creating a mirror of the GCS bucket. However, you can handle this locally created mirror (i.e. the mounted directory) as a \u201cnormal\u201d linux directory.  </p> <p>Be careful...</p> <ul> <li>Any change you make to the locally mounted directory will be replicated (mirrored) in the GCS bucket.</li> <li>Likewise, if you were to make changes directly in the GCS bucket, these would be replicated (mirrored) in the locally mounted directory.  </li> </ul>"},{"location":"using-the-tre/handling-files-and-folders/#how-to-mount-a-red-directory-to-your-vm","title":"How to mount a <code>red</code> directory to your VM?","text":"<p>Create a directory in your home directory with:  </p> <pre><code>mkdir /home/ivm/[dir-name]\n</code></pre> <p>(Replace the <code>[dir-name]</code> with a directory name of your choice.)  </p> <p>Run the following command to mount a shared team directory from red to <code>/home/ivm/[dir-name]</code>:  </p> <pre><code>gcsfuse --implicit-dirs \"$SANDBOX_PROJECT-red\" --only-dir 'MY_TEAM_DIRECTORY' /home/ivm/[dir-name]\n</code></pre> <p>Note</p> <ul> <li>All on a single line</li> <li>You must use double-quote (<code>\"</code>) around <code>$SANDBOX_PROJECT-red</code></li> <li>Replace <code>MY_TEAM_DIRECTORY</code> with the name of a directory in <code>red</code></li> <li>You will need to repeat the <code>gcsfuse</code> command on each reboot of your Virtual Machine, as it won't persist.  </li> </ul> <p>All the members of your team should be able to run this command to have the same shared files in the <code>/home/ivm/[dir-name]</code> directory.  </p>"},{"location":"using-the-tre/handling-files-and-folders/#mounting-illustrated-example","title":"Mounting: illustrated example","text":"<p> Creates a new (empty) directory on <code>/home/ivm</code>:  </p> <p></p> <p>The equivalent directory on <code>red</code> is not empty (it contains several files and sub and sub-sub directories):  </p> <p></p> <p>Now mount <code>red</code>\u2019s <code>JoeBloggs</code> locally:  </p> <p></p> <p>Which tells us:  </p> <p></p> <p>Now look at <code>/home/ivm/JoeBloggs</code>: </p> <p></p> <p>All the files, directories, sub and sub-sub directories from <code>red</code>\u2019s <code>JoeBloggs</code> are mirrored. But <code>/home/ivm/JoeBloggs/</code> \u201cbehaves\u201d like any linux directory:  </p> <p></p> <p>You can add files in any of these various directories:  </p> <p></p> <p>And they appear on the locally mounted <code>JoeBloggs</code>:  </p> <p></p> <p>And  </p> <p></p> <p>But they also appear in the <code>red</code> GCS bucket!  </p> <p></p> <p>And</p> <p></p> <p>Info</p> <p>You may have to click the refresh circular arrow in the top right corner to see the changes. </p> <p>If you delete a file in the GCS red bucket:  </p> <p></p> <p>The file will also be deleted from the locally mounted mirror:</p> <p></p> <p>Likewise, if you delete a file in the locally mounted mirror:  </p> <p></p> <p>The file will also be deleted from the red GCS bucket:</p> <p></p>"},{"location":"using-the-tre/running-a-gwas/","title":"Running a GWAS","text":""},{"location":"using-the-tre/running-a-gwas/#gwas-training-video","title":"GWAS Training Video","text":"<p>Genes &amp; Health have provided a number of training videos to help researchers get started with the Trusted Research Environment (TRE). This is a 45-min tutorial in which GWAS using regenie is demonstrated (300Mb with mp4 format, updated 5 oct 2022). This video is a recording of a live demo session, and the quality may not be perfect. It is recommended to watch the video in full screen mode. </p> <p>Please feel free to download the video and watch it at your convenience.</p>"},{"location":"using-the-tre/running-a-gwas/#gwas-example","title":"GWAS Example","text":"<p>You can find an example regenie script for binary trait GWAS below. Please feel free to adapt and reuse this script.</p> <p>Caution</p> <p>Please let your script run first on the cheap 2-core machine. Regenie has excellent multithreading capabilities and will perform best on the 64-core high-performance machine, but this option is expensive. The 2-core machine is sufficiently fast on a large multicore machine, allowing you to run it directly from the command line using a single all-chromosome pgen input file, without the need for HPC or splitting by chromosome.</p> <p>Regenie will utilise all available threads minus 1 by default, meaning the 64-core machine will run 63 times faster for the compute steps compared to the 2-core machine. It is fast enough on a large multicore machine to run several phenotypes. If you intend to run 1000 phenotypes, you will need to use Google HPC / WDL.</p> <pre><code>## RUN THIS FROM THE FOLDER WITH THE \n## COVAR/PHENO FILES AND WHERE YOU WANT THE OUTPUT\n\n## this is for BINARY TRAITS\n## remove the  --bt and firth etc options for quant traits, see the online regenie manual https://rgcgithub.github.io/regenie/options/\n\n## first copy big files to local storage ivm SSD for better i/o than with google storage buckets\n## regenie will sometimes crash if reading direct from library-red due to slow i/o\n## cp /genesandhealth/library-red/genesandhealth/GSAv3EAMD/Jul2021_44k_TOPMED-r2_Imputation_b38/topmed-r2_merged_version03/chrALLincX.dose.merged_INFO0.3_MAF0.00001_F_MISSING0.2.8bit.sorted.p* /home/ivm/Documents/\n\n## CHANGE THE DATE EACH RUN ## \ndaterun=2022_07_20\n\ncovarfile=\"/genesandhealth/library-red/genesandhealth/GSAv3EAMD/Jul2021_44k_TOPMED-r2_Imputation_b38/GNH.44190.noEthnicOutliers.covariates.20PCs.tab\"\n## updated to covarfile with correct FID IID structure 15 July 2022\n\nphenofile=\"/genesandhealth/library-red/genesandhealth/phenotypes_curated/version005_2022_06/1stoccurrence_3digitICD10_1SNOMEDto1ICD10/2022_06_version005_3digitICD10_1to1_42029withbothICD10andGSAJul2021.txt\"\n\n## these are the custom phenotypes: \"/genesandhealth/library-red//genesandhealth/phenotypes_curated/version005_2022_06/custom/2022-06-15_big_regenie_phenoFile.txt\"\n\ngrmfile=\"/genesandhealth/library-red/genesandhealth/GSAv3EAMD/Jul2021_44k_TOPMED-r2_Imputation_b38/bfile_forSAIGEgrm_44396_chipgenotypes_indep-pairwise_500_50_0.2_LDpruned_NotChrY\"\n\n## regenie will run all phenotypes in the phenoFIle if you dont specify --phenoCol or --phenoColList\n\n## beware the .log file does not have phenotype name in its filename (because it is designed for running many phenotypes at once), can get overwritten if run multiple times using same $daterun\n\n## if want to run male-only or female-only analysis, best to use --keep with a list of individuals in Step1 Step2 rather than --sex-specific. Because sex-specific uses the sex in the bed or pgen files not from the covariate file. And sex is NA in the pgen file we have made\n\nregenie   \\\n  --step 1 \\\n  --bed \"$grmfile\" \\\n  --covarFile \"$covarfile\" \\\n  --phenoFile \"$phenofile\" \\\n  --phenoExcludeList PseudoNHS_2022_02_08 \\\n  --phenoCol ICD10__E10,ICD10__E11 \\\n  --minCaseCount 100 \\\n  --bsize 1000 \\\n  --bt \\\n  --lowmem \\\n  --lowmem-prefix tmp_rg \\\n  --gz \\\n  --verbose \\\n  --out \"$daterun\"_fit_binary_out\n\nregenie \\\n  --step 2 \\\n  --pgen /home/ivm/Documents/chrALLincX.dose.merged_INFO0.3_MAF0.00001_F_MISSING0.2.8bit.sorted \\\n  --covarFile \"$covarfile\" \\\n  --phenoFile \"$phenofile\" \\\n  --bsize 1000 \\\n  --minMAC 20 \\\n  --minINFO 0.6 \\\n  --bt \\\n  --firth --approx \\\n  --pThresh 0.01 \\\n  --pred \"$daterun\"_fit_binary_out_pred.list \\\n  --gz \\\n  --verbose \\\n  --out \"$daterun\"_GNH_binary_GWAS_firth\n\n## END ##\n</code></pre>"},{"location":"using-the-tre/understanding-tre-folders-and-buckets/","title":"Understanding TRE folders and buckets","text":"<p>To undertand how Genes &amp; Health data are stored and how to use the data resources, we need to understand Google Cloud Storage (GCS) buckets.  GCS buckets are used for all data storage in the TRE with the exception of user data in the <code>home</code> directory.</p> <p><code>home</code> directory</p> <p>The <code>home</code> directory is associated with the Gene &amp; Health virtual machines rather than GCS --so it is (and behaves as) a standard unix directory.  Files and directories in <code>home</code> are created, manipulated and deleted as in Unix/Linux.  Strictly speaking, your <code>home</code> directory is a sub-directory of <code>home</code>: <code>/home/ivm</code> --you have read/write access to <code>/home/ivm</code> but read only to <code>/home</code></p> <p><code>home</code> directory persistence</p> <p>The <code>home</code> directory is persistent. When you close a virtual machine, the <code>home</code> direcotry will not be deleted and will present the same way next time you spin a new virtual machine --regardless of the configuration of the new VM. <p>Although the <code>home</code> directory is persistent, its use is recommended only for development purposes; we advise ensuring critical code and data are regularly copied to the <code>red</code> folder.</p>"},{"location":"using-the-tre/understanding-tre-folders-and-buckets/#understanding-google-cloud-storage-gcs-buckets","title":"Understanding Google Cloud Storage (GCS) buckets","text":"<p>Genes &amp; Health TRE data are stored in Google Cloud Storage (GCS) buckets (on a server located in London, UK). Buckets are the basic data container for GCS and everything stored in GCS must be contained in a bucket.</p> <p>Each of the G&amp;H TRE top level storage domains are separate GCS buckets, for example, <code>library-red</code>, <code>red</code>, <code>green</code> and <code>exomes-library-red</code>. Files in a G&amp;H TRE bucket are just that. The bucket contains a collection of files.</p>"},{"location":"using-the-tre/understanding-tre-folders-and-buckets/#gcs-buckets-and-directories","title":"GCS buckets and directories","text":"<p>The concept of a physical directory does not rightly exist in GCS. Rather, directories are \u201csimulated\u201d by GCS from the files name. This can be illustrated as follows:  </p> <p></p> <p>In the image above, the filenames are <code>A/Obj1.txt</code>, <code>A/Obj2.txt</code>, <code>B/Obj3.txt</code>, <code>B/D/Obj3.txt</code> and <code>B/D/Obj4.txt</code> and the files simply exists a files in the bucket with those filenames. Bucket folders <code>A/</code>, <code>B/</code> its sub-folder <code>D/</code> are simulated. This means that if you were to delete <code>A/Obj1.txt</code> and <code>A/Obj2.txt</code>, the simulated folder <code>A/</code> would disappear (there would no longer be any files justifying its existence). However, if you were to delete file <code>B/Obj3.txt</code>, both simulated folder <code>B/</code> its sub-folder <code>D/</code> would remains as they would be accounted for by filenames <code>B/D/Obj3.txt</code> and <code>B/D/Obj4.txt</code>.</p> <p>If you were to delete all the .txt files in the bucket, all of the directories would disappear but the bucket would remain in existance.</p>"},{"location":"using-the-tre/understanding-tre-folders-and-buckets/#ghs-root-directory","title":"G&amp;H's <code>root</code> directory (<code>/</code>)","text":"<p>The G&amp;H data buckets reside in the <code>genesandhealth</code> folder of the VM's root directory (<code>/</code>).  The <code>home</code> directory also resides within the VM's root directory.  </p> <p>Warning</p> <p>Other directories under the VM's root directory are system, software and VM related folders and not of use to TRE users.</p> <p></p>"},{"location":"using-the-tre/understanding-tre-folders-and-buckets/#gh-data-buckets","title":"G&amp;H data buckets","text":"<p>G&amp;H data buckets can be found in the <code>/genesandhealth</code> directory.  Depending on your sandbox, you will see different buckets (essentially behaving as directories) in your <code>/genesandhealth</code> directory</p> <p>Bucket nomenclature</p> <p>G&amp;H buckets are named <code>red</code> and <code>green</code> or suffixed with <code>-red</code> or <code>-green</code> to indicate the type of data stored in them: <code>red</code> is for potentially sensitive data that should not be shared outside your sandbox; <code>green</code> is for data that can be shared with the outside world. </p> <p>When you log into your sandbox, your VM will have a number of buckets available for you.  Here are some of the buckets (top level \"directories\") in the G&amp;H sandbox-1 TRE:</p> <p></p>"},{"location":"using-the-tre/understanding-tre-folders-and-buckets/#identifying-gh-gcs-buckets","title":"Identifying G&amp;H GCS buckets","text":"<p>G&amp;H buckets can be identified into two way within the TRE --depending on the file operation you may need to use one or the other method of identifying the bucket:</p> <ol> <li>As a path on the virtual machine (e.g. (<code>/genesandhealth/red/</code>)</li> <li>As a Google Cloud Storage bucket identified by a Uniform Resource Locator (URL), for example <code>gs://qmul-production-sandbox-1-red/</code> identifies the <code>red</code> bucket on sanddox-1.</li> </ol> <p>The bucket's URL will depend on the sandbox you use.  </p>"},{"location":"using-the-tre/understanding-tre-folders-and-buckets/#whats-in-the-bucket","title":"What's in the bucket?","text":"<p>The fundamental storage resources in the TRE are:</p> <ul> <li>the <code>library-red</code> and <code>red</code> buckets containing respectively the G&amp;H -omics data and your sandbox's data</li> <li>your <code>home</code> directory</li> </ul> <p>These exist alongside a number of other data resources as illustrated below.  Key data resources are then individually described.</p> <p></p>"},{"location":"using-the-tre/understanding-tre-folders-and-buckets/#your-home-directory","title":"Your <code>home</code> directory","text":"<p>Identifying <code>home</code></p> <ul> <li>Specificity: sandbox specific</li> <li>VM directory: <code>/home/ivm</code></li> <li>URL: Not applicable</li> </ul> <p>Available at <code>/home/ivm</code> in your sandbox, this is your personal folder. This folder can be used to store any files you wish to keep in your working directories. <code>/home/ivm</code> is a semi-fast (HDD) storage and as such is faster than other parts of the sandbox. It might be worth running some jobs here, especially if you are loading large amounts of data.</p> <p>This folder should not be treated as a permanent/long-term storage so anything you want to keep should be moved to the <code>red</code> folder. However, snapshots of the disk/folder are taken on daily basis and are retained for a period of 7-days. In-case you accidently delete some useful data from the <code>/home/ivm</code> folder, you can reach out to the TRE Admins to check if it is possible to recover the disk to a previous snapshot date within last 7 days.</p> <p>This works as a standard Unix/Linux directory and is not a google GCS bucket. </p>"},{"location":"using-the-tre/understanding-tre-folders-and-buckets/#-red-buckets","title":"<code>(-)red</code> buckets","text":""},{"location":"using-the-tre/understanding-tre-folders-and-buckets/#the-library-red-bucket-read-only-for-users","title":"The <code>library-red</code> bucket [read-only for users]","text":"<p>Identifying <code>library-red</code></p> <ul> <li>Specificity: common to all sandboxes</li> <li>VM directory: <code>/genesandhealth/library-red/</code></li> <li>URL: <code>gs://qmul-sandbox-production-library-red/</code></li> </ul> <p>This is a read-only folder that is common to all TRE users. <code>library-red</code> stores curated and raw data necessary for your analyses; it includes several subfolders, each designated for specific data types and purposes.  For technical reasons, the data subfolders are actually in <code>/genesandhealth/library-red/genesandhealth/</code>.  Folder names are (relatively) self-explanatory and all of them should contain a <code>README</code> type file explaining their content.  If you find a folder without a <code>README</code> file, please contact the Genes and Health team for more information on its intended use.</p>"},{"location":"using-the-tre/understanding-tre-folders-and-buckets/#the-red-bucket","title":"The <code>red</code> bucket","text":"<p>Identifying <code>red</code></p> <ul> <li>Specificity: sandbox specific</li> <li>VM directory: <code>/genesandhealth/red/</code></li> <li>URL: <code>gs://qmul-production-sandbox-XX-red/</code> (replace <code>XX</code> with your sandbox number) </li> </ul> <p>The <code>red</code> bucket is a read-write bucket for TRE users to store scripts and data safely (with versioning back-up) and to permit the sharing of these between project collaborators. It is the only GCS bucket directly accessible to non-admin TRE users.  You are advised to create your own subfolder in <code>red</code>; user folders are typically created as FirstnameLastname (so <code>/genesandhealth/red/JoeBloggs/</code>) although some iconoclasts have broken this convention.</p> <p>With great power...</p> <p>The <code>red</code> bucket is shared between all sandbox users --even if you have created your own sub-directory.  This means that you can:</p> <ul> <li>See all other sandbox users' files (and all other sandbox users can see your files)</li> <li>Move/rename/delete any sandbox users' files  <p> Exercise caution when moving or deleting files in the <code>red</code> bucket."},{"location":"using-the-tre/understanding-tre-folders-and-buckets/#the-consortiumpriorityperiod-library-red-bucket","title":"The <code>consortiumpriorityperiod-library-red</code> bucket","text":"<p>Identifying <code>consortiumpriorityperiod-library-red</code></p> <ul> <li>Specificity: restricted sandboxes</li> <li>VM directory: <code>/genesandhealth/consortiumpriorityperiod-library-red/</code></li> <li>URL: <code>gs://qmul-sandbox-production-library-consortiumpriorityperiod-red</code> </li> </ul> <p>This bucket is only available to the core Genes &amp; Health team, and to companies in the Genes &amp; Health Industry Consortium. It contains data restricted during priority access periods (e.g. exome sequencing). Specifically, read access is only for sandboxes 1, 3, 4, 5, 6, 7, 9, 10, 13.</p> <p>Same storage type as <code>/genesandhealth/library-red</code>, see above.</p>"},{"location":"using-the-tre/understanding-tre-folders-and-buckets/#-green-buckets","title":"<code>(-)green</code> buckets","text":""},{"location":"using-the-tre/understanding-tre-folders-and-buckets/#the-green-bucket-read-only-for-users","title":"The <code>green</code> bucket [read-only for users]","text":"<p>Identifying <code>green</code></p> <ul> <li>Specificity: sandbox specific</li> <li>VM directory: <code>/genesandhealth/green/</code></li> <li>URL: <code>gs://fg-qmul-production-sandbox-XX\\_green/</code> (replace <code>XX</code> with your sandbox number) </li> </ul> <p><code>green</code> can be read by other users in the sandbox. Users cannot write to <code>green</code>.  Users can download from <code>/genesandhealth/green</code> from the internet/external systems.</p> <p>The admin team will review data-out requests, and either place the data in <code>green</code> (for specific users to download, short term) or <code>library-green</code> (long term availability for all users to download).</p> <p>Data in <code>green</code></p> <p>Data in each sandbox's <code>green</code> will be deleted approximately 1 week after creation. <code>green</code> is not intended for long term storage, only data transfer/download.</p>"},{"location":"using-the-tre/understanding-tre-folders-and-buckets/#the-consortiumpriorityperiod-library-green-bucket","title":"The <code>consortiumpriorityperiod-library-green</code> bucket","text":"<p>Identifying <code>consortiumpriorityperiod-library-green</code></p> <ul> <li>Specificity: restricted sandboxes</li> <li>VM directory: <code>/genesandhealth/consortiumpriorityperiod-library-green/</code></li> <li>URL: <code>gs://qmul-sandbox-production-library-consortiumpriorityperiod-green</code></li> </ul> <p>Access as for <code>consortiumpriorityperiod-library-red</code> but with external download enabled. Used for results. Not for individual level data.</p>"},{"location":"using-the-tre/understanding-tre-folders-and-buckets/#other-folders","title":"Other folders","text":""},{"location":"using-the-tre/understanding-tre-folders-and-buckets/#shared","title":"<code>shared</code>","text":"<p>You can 'publish' a file to <code>/genesandhealth/shared</code> by right clicking on it, and selected 'Share with all users'</p> <p><code>/genesandhealth/shared</code> is available to all other users within the TRE.</p>"},{"location":"using-the-tre/understanding-tre-folders-and-buckets/#pipelines","title":"<code>pipelines</code>","text":"<p>This is the output of the high performance compute WDL Pipelines, that the ivm/pipeline writes to. Users of the sandbox have read only access.</p> <p>Specific to each sandbox.</p> <p>This is slower storage of large capacity (&gt;8 PiB @ Feb 2022)</p>"},{"location":"using-the-tre/understanding-tre-folders-and-buckets/#public-datasets-bucket","title":"Public datasets bucket","text":"<p>We also maintain a bucket for public datasets. This is not visible from within the TRE. Much of the data is mirrored in <code>/genesandhealth/library-green/</code> within the TRE.</p> <pre><code>gs://genesandhealth\\_publicdatasets/\n</code></pre>"},{"location":"using-the-tre/understanding-tre-folders-and-buckets/#backups","title":"Backups","text":"<p>Data in selected folders is protected from accidental deletion or alteration by the Google Object Versioning service. Specifically, for data in these folders -</p>"},{"location":"using-the-tre/understanding-tre-folders-and-buckets/#backups-shared-folders","title":"Backups: Shared folders","text":"<p>/genesandhealth/library-red , 1 version, 30 days</p> <p>/genesandhealth/consortiumpriorityperiod-library-red, 1 version, 30 days</p> <p>/genesandhealth/nhsdigital-sublicence-red, 1 version, 30 days</p>"},{"location":"using-the-tre/understanding-tre-folders-and-buckets/#backups-sandbox-specific-folders","title":"Backups: Sandbox-specific folders","text":"<p>/genesandhealth/red, 2 versions, 30 days</p> <p>/genesandhealth/pipeline, 1 version, 7 days</p> <p>We will keep either a) the prior version of the data prior to a change (or deletion) by a user for 30 days , or b) two prior versions of the data prior to a change (or deletion) by a user for 30 days.</p> <p>This allows the prior version to be restored, in the event of accidental erasure or deletion.</p> <p>To say this another way: imagine you accidentally alter or delete a file in the /genesandhealth/library-red folder. Then the version of the file prior to its removal can be restored, for up to 30 days after the change. In the sandbox-specific /genesandhealth/red folder, two prior versions of the file will be kept, each for 30 days after the change leading to its creation.</p> <p>Restoring a prior version of an accidentally removed or modified file requires utilities only available to administrators: if you need this, contact us by writing to hgi@sanger.ac.uk, including the word \"Urgent\" in the subject header.</p>"}]}